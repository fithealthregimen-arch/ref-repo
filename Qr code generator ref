<!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR Code Generator Libraries - Multiple sources for reliability -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AdSense Protection Meta Tags -->
    <meta name="adsense-protection" content="isolated">
    <meta name="qr-tool-version" content="adsense-safe-v1.0">
    
    <style>
        /* ADSENSE PROTECTION LAYER 1: Complete CSS Reset & Isolation */
        .qr-app-isolation-layer {
            /* Reset and isolate from parent page */
            all: initial !important;
            position: relative !important;
            display: block !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            background: transparent !important;
            width: 100% !important;
            min-height: 100vh !important;
            max-width: 100vw !important;
            overflow-x: hidden !important;
            
            /* CSS Containment to prevent style bleeding */
            contain: layout style paint !important;
            isolation: isolate !important;
            
            /* Create new stacking context */
            z-index: 1 !important;
            
            /* Prevent AdSense interference */
            -webkit-transform: translateZ(0) !important;
            transform: translateZ(0) !important;
            will-change: transform !important;
        }
        
        /* Critical CSS for immediate rendering - prevents FOUC */
        .qr-app-isolation-layer body,
        .qr-app-isolation-layer .qr-body-reset { 
            margin: 0 !important; 
            padding: 0 !important; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            overflow-x: hidden !important;
            max-width: 100vw !important;
            background: transparent !important;
        }
        
        .qr-tool-container { 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
            min-height: 100vh !important;
            overflow-x: hidden !important;
            max-width: 100vw !important;
            position: relative !important;
            z-index: 10 !important;
        }
        
        .qr-gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; 
            color: white !important;
        }
        
        /* ADSENSE PROTECTION LAYER 2: Strong CSS Isolation */
        .qr-tool-container,
        .qr-tool-container * {
            box-sizing: border-box !important;
            /* Prevent AdSense script injection */
            content: none !important;
        }
        
        /* Block AdSense from modifying QR tool elements */
        .qr-tool-container *::before,
        .qr-tool-container *::after {
            content: none !important;
            display: none !important;
        }
        
        /* Override any external CSS that might interfere */
        .qr-tool-container * {
            position: static !important;
            top: auto !important;
            left: auto !important;
            right: auto !important;
            bottom: auto !important;
        }
        
        .qr-tool-container *:not(.qr-positioned) {
            position: relative !important;
        }
        
        .qr-gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #6B73FF 50%, #9068be 75%, #a8edea 100%) !important;
            background-size: 300% 300% !important;
            animation: qrGradientShift 8s ease infinite !important;
        }
        
        @keyframes qrGradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .qr-card-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05) !important;
        }
        
        .qr-glassmorphism {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }
        
        .qr-file-drop-zone {
            border: 3px dashed #cbd5e1 !important;
            transition: all 0.4s ease !important;
            background: linear-gradient(145deg, #f8fafc, #f1f5f9) !important;
        }
        
        .qr-file-drop-zone:hover,
        .qr-file-drop-zone.dragover {
            border-color: #6366f1 !important;
            background: linear-gradient(145deg, #eef2ff, #e0e7ff) !important;
            transform: scale(1.02) !important;
        }
        
        .qr-btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3) !important;
        }
        
        .qr-btn-primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4) !important;
        }
        
        .qr-btn-secondary {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            transition: all 0.3s ease !important;
        }
        
        .qr-btn-secondary:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3) !important;
        }
        
        .qr-fade-in {
            animation: qrFadeIn 0.6s ease-in-out !important;
        }
        
        @keyframes qrFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .qr-slide-up {
            animation: qrSlideUp 0.5s ease-out !important;
        }
        
        @keyframes qrSlideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .qr-success-toast {
            background: linear-gradient(135deg, #059669, #10b981) !important;
        }
        
        .qr-error-toast {
            background: linear-gradient(135deg, #dc2626, #ef4444) !important;
        }
        
        .qr-tab-active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            color: white !important;
        }
        
        .qr-tab-inactive {
            background: rgba(255, 255, 255, 0.1) !important;
            color: #64748b !important;
        }
        
        .qr-feature-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc) !important;
            border: 1px solid #e2e8f0 !important;
            transition: all 0.3s ease !important;
        }
        
        .qr-feature-card:hover {
            transform: translateY(-4px) !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
        }
        
        .qr-input-group {
            position: relative !important;
        }
        
        .qr-input-group input, .qr-input-group select {
            border: 2px solid #e2e8f0 !important;
            border-radius: 12px !important;
            padding: 12px 16px !important;
            transition: all 0.3s ease !important;
        }
        
        .qr-input-group input:focus, .qr-input-group select:focus {
            border-color: #6366f1 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
            outline: none !important;
        }
        
        .qr-toggle-switch {
            position: relative !important;
            width: 50px !important;
            height: 24px !important;
            background: #cbd5e1 !important;
            border-radius: 24px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
        }
        
        .qr-toggle-switch.active {
            background: #6366f1 !important;
        }
        
        .qr-toggle-switch::after {
            content: '' !important;
            position: absolute !important;
            width: 20px !important;
            height: 20px !important;
            background: white !important;
            border-radius: 50% !important;
            top: 2px !important;
            left: 2px !important;
            transition: all 0.3s ease !important;
        }
        
        .qr-toggle-switch.active::after {
            left: 28px !important;
        }

        /* QR Type Buttons */
        .qr-type-btn {
            background: transparent !important;
            color: #6b7280 !important;
            transition: all 0.3s ease !important;
        }
        
        .qr-type-btn.active {
            background: white !important;
            color: #1f2937 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        }
        
        /* Text Presets */
        .text-preset {
            background: #f3f4f6 !important;
            color: #374151 !important;
            padding: 8px 12px !important;
            border-radius: 6px !important;
            font-size: 12px !important;
            border: none !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        
        .text-preset:hover {
            background: #e5e7eb !important;
            color: #1f2937 !important;
        }

        /* Mobile Responsive Optimizations */
        @media (max-width: 768px) {
            .qr-tool-container {
                padding: 8px 4px !important;
            }
            
            .qr-gradient-bg {
                padding: 16px 12px !important;
                margin-bottom: 16px !important;
            }
            
            .qr-feature-card {
                padding: 16px !important;
                margin-bottom: 16px !important;
            }
            
            .qr-file-drop-zone {
                padding: 24px 16px !important;
                min-height: 120px !important;
                max-width: 100% !important;
                overflow: hidden !important;
                word-wrap: break-word !important;
            }
            
            .qr-btn-primary, .qr-btn-secondary {
                padding: 12px 20px !important;
                font-size: 14px !important;
                width: 100% !important;
                margin-bottom: 8px !important;
            }
            
            .qr-input-group input, .qr-input-group select, .qr-input-group textarea {
                padding: 12px !important;
                font-size: 16px !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .grid {
                grid-template-columns: 1fr !important;
                gap: 16px !important;
            }
            
            .flex {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            
            .text-2xl { font-size: 20px !important; }
            .text-xl { font-size: 18px !important; }
            .text-lg { font-size: 16px !important; }
            
            /* Fix overflow issues */
            * {
                max-width: 100% !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            
            img, canvas, .qr-code-container {
                max-width: 100% !important;
                height: auto !important;
                display: block !important;
                margin: 0 auto !important;
            }
            
            #qr-code-container {
                max-width: 100% !important;
                width: auto !important;
                display: block !important;
                margin: 0 auto !important;
                padding: 16px !important;
            }
            
            /* Result section overflow fixes */
            #results-section, #text-results-section {
                max-width: 100% !important;
                overflow: hidden !important;
                word-wrap: break-word !important;
            }
            
            .result-preview, .qr-preview {
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .result-preview img, .qr-preview img, .result-preview canvas, .qr-preview canvas {
                max-width: 100% !important;
                height: auto !important;
                display: block !important;
                margin: 0 auto !important;
            }
            
            /* Share buttons overflow fix */
            .share-buttons, .action-buttons {
                flex-wrap: wrap !important;
                max-width: 100% !important;
            }
            
            /* URL display overflow fix */
            .share-url, .result-url {
                word-break: break-all !important;
                overflow-wrap: break-word !important;
                max-width: 100% !important;
            }
            
            /* Specific mobile fixes for result elements */
            .qr-glassmorphism {
                max-width: 100% !important;
                overflow: hidden !important;
                word-wrap: break-word !important;
            }
            
            .qr-feature-card {
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            /* Input and button mobile fixes */
            input, select, textarea, button {
                max-width: 100% !important;
                box-sizing: border-box !important;
            }
            
            /* Tab navigation mobile fix */
            .qr-tab-nav {
                flex-wrap: wrap !important;
                gap: 8px !important;
            }
            
            .qr-tab-nav button {
                flex: 1 !important;
                min-width: 120px !important;
                padding: 8px 12px !important;
                font-size: 14px !important;
            }
            
            /* Stats dashboard mobile optimization */
            .stats-grid {
                grid-template-columns: 1fr 1fr !important;
                gap: 12px !important;
            }
            
            /* Modal and popup mobile fixes */
            .modal-content {
                width: 95% !important;
                max-width: 95% !important;
                margin: 10px !important;
            }
            

        }

        @media (max-width: 480px) {
            .qr-tool-container {
                padding: 4px 2px !important;
            }
            
            .qr-gradient-bg {
                padding: 12px 8px !important;
                border-radius: 12px !important;
            }
            
            .qr-feature-card {
                padding: 12px !important;
                border-radius: 12px !important;
            }
            
            .qr-file-drop-zone {
                padding: 16px 8px !important;
                min-height: 100px !important;
            }
            
            .text-xl { font-size: 16px !important; }
            .text-lg { font-size: 15px !important; }
            .text-base { font-size: 14px !important; }
            
            /* Ultra-compact mobile layout */
            .stats-grid {
                grid-template-columns: 1fr !important;
            }
            
            .qr-tab-nav button {
                min-width: 100px !important;
                padding: 6px 8px !important;
                font-size: 12px !important;
            }
        }

        /* Prevent horizontal scroll and ensure proper containment */
        html, body {
            overflow-x: hidden !important;
            max-width: 100vw !important;
        }
        
        .qr-tool-container {
            overflow-x: hidden !important;
            max-width: 100vw !important;
        }
        
        /* Ensure all containers respect viewport width */
        .container, .w-full, [class*="max-w"] {
            max-width: 100vw !important;
            box-sizing: border-box !important;
        }

        /* Critical CSS for faster initial loading */
        .qr-tool-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
        }

        /* Immediate visibility styles to prevent FOUC */
        .qr-gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
        }


        /* QR Type Selection Styles */
        .qr-type-card {
            background: rgba(255, 255, 255, 0.8) !important;
            border: 2px solid transparent !important;
            border-radius: 16px !important;
            transition: all 0.3s ease !important;
            backdrop-filter: blur(10px) !important;
        }

        .qr-type-card:hover {
            background: rgba(255, 255, 255, 0.95) !important;
            border-color: rgba(102, 126, 234, 0.3) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15) !important;
        }

        .qr-type-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-color: #667eea !important;
            color: white !important;
            transform: translateY(-3px) !important;
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.25) !important;
        }

        .qr-type-card.active i {
            color: white !important;
        }

        .qr-type-card.active h3,
        .qr-type-card.active p {
            color: white !important;
        }

        .qr-content-type {
            display: block !important;
        }

        .qr-content-type.hidden {
            display: none !important;
        }
        
        /* Scroll-triggered ad styles */
        .scroll-ad {
            background: white !important;
            border: 2px solid #e2e8f0 !important;
            border-radius: 12px !important;
            margin: 2rem 0 !important;
            padding: 1.5rem !important;
            text-align: center !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05) !important;
            opacity: 0 !important;
            transform: translateY(30px) !important;
            transition: all 0.6s ease !important;
        }
        
        .scroll-ad.visible {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
        
        .scroll-ad-label {
            font-size: 11px !important;
            color: #a0aec0 !important;
            text-transform: uppercase !important;
            letter-spacing: 1px !important;
            margin-bottom: 10px !important;
            font-weight: 600 !important;
        }
        
        @media (max-width: 768px) {
            .scroll-ad {
                margin: 1.5rem 0 !important;
                padding: 1rem !important;
            }
        }
    </style>
</head>
<body class="qr-body-reset">

    <!-- ADSENSE PROTECTION: Isolation Container -->
    <div class="qr-app-isolation-layer" id="qr-app-root">
        <!-- AdSense Blocker Script -->
        <script>
            // ADSENSE PROTECTION LAYER 3: JavaScript Isolation
            (function() {
                'use strict';
                
                // Create isolated namespace
                window.QR_TOOL_ISOLATED = window.QR_TOOL_ISOLATED || {};
                
                // Prevent AdSense from modifying our elements
                const originalInsertAdjacentHTML = Element.prototype.insertAdjacentHTML;
                const originalInsertAdjacentElement = Element.prototype.insertAdjacentElement;
                const originalAppendChild = Element.prototype.appendChild;
                const originalInsertBefore = Element.prototype.insertBefore;
                
                // Override DOM modification methods within our container
                function protectContainer() {
                    const qrContainer = document.querySelector('.qr-app-isolation-layer');
                    if (!qrContainer) return;
                    
                    // Protect against external script injection
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'childList') {
                                mutation.addedNodes.forEach(function(node) {
                                    // Check if it's an AdSense element trying to inject
                                    if (node.nodeType === 1 && (
                                        node.className && (
                                            node.className.includes('adsbygoogle') ||
                                            node.className.includes('google-auto-placed') ||
                                            node.className.includes('google-ad')
                                        ) ||
                                        node.tagName === 'INS' ||
                                        (node.src && node.src.includes('googlesyndication'))
                                    )) {
                                        console.log('AdSense injection blocked in QR tool');
                                        node.remove();
                                    }
                                });
                            }
                        });
                    });
                    
                    observer.observe(qrContainer, {
                        childList: true,
                        subtree: true
                    });
                    
                    // Store the observer for cleanup
                    window.QR_TOOL_ISOLATED.observer = observer;
                }
                
                // Initialize protection when DOM is ready
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', protectContainer);
                } else {
                    protectContainer();
                }
                
                // Prevent global variable pollution
                window.QR_TOOL_ISOLATED.protectContainer = protectContainer;
            })();
        </script>
        
        <div class="qr-tool-container min-h-screen py-4 px-2 sm:px-4">
        <div class="w-full max-w-none mx-auto" style="width: 98%; max-width: 98vw;">
            <!-- Compact Hero Section -->
            <div class="text-center mb-6">
                <div class="qr-gradient-bg text-white py-6 px-6 rounded-2xl qr-card-shadow relative overflow-hidden">
                    <!-- Animated Background Elements -->
                    <div class="absolute inset-0 opacity-10">
                        <div class="absolute top-4 left-4 w-8 h-8 border-2 border-white rounded transform rotate-45"></div>
                        <div class="absolute top-8 right-8 w-6 h-6 bg-white rounded-full"></div>
                        <div class="absolute bottom-4 left-1/4 w-4 h-4 border border-white"></div>
                        <div class="absolute bottom-6 right-1/3 w-3 h-3 bg-white transform rotate-45"></div>
                    </div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-center mb-3">
                            <div class="bg-white bg-opacity-20 p-3 rounded-xl mr-4">
                                <i class="fas fa-qrcode text-2xl"></i>
                            </div>
                            <div class="text-left">
                                <h1 class="text-3xl font-bold mb-1">QR Code Generator Pro</h1>
                                <p class="text-lg opacity-90">Professional file sharing with custom QR codes</p>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap justify-center gap-2 text-xs">
                            <span class="bg-white bg-opacity-15 backdrop-blur px-3 py-1 rounded-full border border-white border-opacity-20">
                                <i class="fas fa-mobile-alt mr-1"></i>Mobile Ready
                            </span>
                            <span class="bg-white bg-opacity-15 backdrop-blur px-3 py-1 rounded-full border border-white border-opacity-20">
                                <i class="fas fa-palette mr-1"></i>Customizable
                            </span>
                            <span class="bg-white bg-opacity-15 backdrop-blur px-3 py-1 rounded-full border border-white border-opacity-20">
                                <i class="fas fa-shield-alt mr-1"></i>Secure
                            </span>
                            <span class="bg-white bg-opacity-15 backdrop-blur px-3 py-1 rounded-full border border-white border-opacity-20">
                                <i class="fas fa-chart-line mr-1"></i>Analytics
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="qr-glassmorphism rounded-2xl p-2 mb-8 qr-card-shadow">
                <div class="flex flex-wrap gap-2">
                    <button id="tab-upload" class="qr-tab-active px-6 py-3 rounded-xl font-semibold transition-all">
                        <i class="fas fa-upload mr-2"></i>Upload & Generate
                    </button>
                    <button id="tab-customize" class="qr-tab-inactive px-6 py-3 rounded-xl font-semibold transition-all">
                        <i class="fas fa-palette mr-2"></i>Customize QR
                    </button>
                    <button id="tab-privacy" class="qr-tab-inactive px-6 py-3 rounded-xl font-semibold transition-all">
                        <i class="fas fa-shield-alt mr-2"></i>Privacy & Security
                    </button>
                    <button id="tab-share" class="qr-tab-inactive px-6 py-3 rounded-xl font-semibold transition-all">
                        <i class="fas fa-share-alt mr-2"></i>Share Options
                    </button>
                    <button id="tab-analytics" class="qr-tab-inactive px-6 py-3 rounded-xl font-semibold transition-all">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                </div>
            </div>

            <!-- Upload Tab -->
            <div id="content-upload" class="tab-content">
                <!-- QR Type Selection -->
                <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                        <i class="fas fa-qrcode mr-3 text-blue-600"></i>Choose QR Code Type
                    </h2>
                    
                    <!-- QR Type Grid - Optimized for Mobile -->
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-2 sm:gap-3 md:gap-4">
                        <!-- File Upload QR -->
                        <div class="qr-type-card active" data-type="file">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-file-upload text-xl sm:text-2xl md:text-3xl text-blue-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">File Upload</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">PDF, Images, Documents</p>
                            </div>
                        </div>

                        <!-- URL QR -->
                        <div class="qr-type-card" data-type="url">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-link text-xl sm:text-2xl md:text-3xl text-green-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">URL / Website</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">Single or multiple links</p>
                            </div>
                        </div>

                        <!-- WiFi QR -->
                        <div class="qr-type-card" data-type="wifi">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-wifi text-xl sm:text-2xl md:text-3xl text-purple-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">Wi-Fi Access</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">Auto-connect to WiFi</p>
                            </div>
                        </div>

                        <!-- Contact QR -->
                        <div class="qr-type-card" data-type="contact">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-address-card text-xl sm:text-2xl md:text-3xl text-orange-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">Contact (vCard)</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">Save contact info</p>
                            </div>
                        </div>

                        <!-- Email QR -->
                        <div class="qr-type-card" data-type="email">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-envelope text-xl sm:text-2xl md:text-3xl text-red-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">Email</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">Prefilled email draft</p>
                            </div>
                        </div>

                        <!-- Location QR -->
                        <div class="qr-type-card" data-type="location">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-map-marker-alt text-xl sm:text-2xl md:text-3xl text-teal-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">Location</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">GPS coordinates</p>
                            </div>
                        </div>

                        <!-- Calendar QR -->
                        <div class="qr-type-card" data-type="calendar">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-calendar-alt text-xl sm:text-2xl md:text-3xl text-indigo-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">Calendar Event</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">Add to calendar</p>
                            </div>
                        </div>

                        <!-- SMS QR -->
                        <div class="qr-type-card" data-type="sms">
                            <div class="text-center p-2 sm:p-3 md:p-4 rounded-xl cursor-pointer transition-all hover:transform hover:scale-105">
                                <i class="fas fa-sms text-xl sm:text-2xl md:text-3xl text-pink-600 mb-1 sm:mb-2 md:mb-3"></i>
                                <h3 class="font-semibold text-gray-800 text-xs sm:text-sm">SMS Message</h3>
                                <p class="text-xs text-gray-500 mt-1 hidden sm:block">Prefilled text message</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8">
                    <!-- Dynamic Content Section -->
                    <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                        <div id="qr-content-header" class="text-center mb-6">
                            <i id="qr-content-icon" class="fas fa-file-upload text-4xl text-blue-600 mb-3"></i>
                            <h2 id="qr-content-title" class="text-2xl font-bold text-gray-800">Upload Your File</h2>
                            <p id="qr-content-subtitle" class="text-gray-500 text-sm">Upload files and generate QR codes for easy sharing</p>
                        </div>

                        <!-- File Upload Content -->
                        <div id="content-file" class="qr-content-type">
                            <!-- Enhanced File Drop Zone -->
                            <div id="qr-drop-zone" class="qr-file-drop-zone rounded-2xl p-8 text-center mb-6 cursor-pointer">
                                <div class="mb-4">
                                    <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-3"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-2">Drop files here or choose upload method</h3>
                                <p class="text-gray-500 mb-4 text-sm">Support for PDF, Word, Excel, Images and more (Max: 100 MB)</p>
                                
                                <!-- Upload Options -->
                                <div class="flex flex-wrap justify-center gap-3 mb-4">
                                    <button id="single-upload-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-file mr-2"></i>Single File
                                    </button>
                                    <button id="batch-upload-btn" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700 transition-colors">
                                        <i class="fas fa-files mr-2"></i>Batch Upload
                                    </button>
                                    <button id="camera-upload-btn" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700 transition-colors">
                                        <i class="fas fa-camera mr-2"></i>Camera
                                    </button>
                                </div>
                                
                                <div class="flex flex-wrap justify-center gap-2 text-xs">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">PDF</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded">DOCX</span>
                                    <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded">XLSX</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">JPG</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">PNG</span>
                                    <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded">+More</span>
                                </div>
                                
                                <!-- Hidden Inputs -->
                                <input type="file" id="qr-file-input" class="hidden" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.svg,.txt,.zip,.rar">
                                <input type="file" id="qr-batch-input" class="hidden" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.svg,.txt,.zip,.rar">
                                <input type="file" id="qr-camera-input" class="hidden" accept="image/*" capture="environment">
                            </div>
                            
                            <!-- Batch Upload Progress -->
                            <div id="batch-progress-container" class="hidden mb-6">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h4 class="font-semibold mb-3">üìä Batch Upload Progress</h4>
                                    <div id="batch-files-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                                    <div class="mt-3">
                                        <div class="flex justify-between text-sm mb-1">
                                            <span>Overall Progress</span>
                                            <span id="batch-overall-progress">0%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-2">
                                            <div id="batch-overall-bar" class="qr-gradient-bg h-2 rounded-full transition-all" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Upload Progress -->
                            <div id="qr-upload-progress" class="hidden mb-6">
                                <div class="bg-gray-200 rounded-full h-4 mb-3">
                                    <div id="qr-progress-bar" class="qr-gradient-bg h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <p id="qr-progress-text" class="text-center text-gray-600 font-medium">Uploading...</p>
                            </div>

                            <!-- Upload Button -->
                            <button id="qr-upload-btn" class="qr-btn-primary text-white px-8 py-4 rounded-2xl font-semibold w-full disabled:opacity-50 disabled:cursor-not-allowed text-lg" disabled>
                                <i class="fas fa-upload mr-2"></i>
                                <span id="qr-upload-btn-text">Select a file to upload</span>
                            </button>
                        </div>

                        <!-- URL Content -->
                        <div id="content-url" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üîó Website URL(s)</label>
                                    <textarea id="url-input" placeholder="Enter single URL or multiple URLs (one per line)&#10;https://example.com&#10;https://youtube.com/watch?v=..." 
                                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="4"></textarea>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="shorten-urls" class="mr-2">
                                        <span class="text-sm text-gray-700">Shorten URLs for better QR readability</span>
                                    </label>
                                </div>
                                <button id="generate-url-qr" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                                    <i class="fas fa-qrcode mr-2"></i>Generate URL QR Code
                                </button>
                            </div>
                        </div>

                        <!-- WiFi Content -->
                        <div id="content-wifi" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üì∂ Network Name (SSID)</label>
                                    <input type="text" id="wifi-ssid" placeholder="MyWiFiNetwork" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üîí Password</label>
                                    <input type="password" id="wifi-password" placeholder="WiFi Password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üõ°Ô∏è Security Type</label>
                                    <select id="wifi-security" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="WPA">WPA/WPA2 (Most Common)</option>
                                        <option value="WEP">WEP (Older)</option>
                                        <option value="nopass">Open Network (No Password)</option>
                                    </select>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="wifi-hidden" class="mr-2">
                                        <span class="text-sm text-gray-700">Hidden Network</span>
                                    </label>
                                </div>
                                <button id="generate-wifi-qr" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-wifi mr-2"></i>Generate WiFi QR Code
                                </button>
                            </div>
                        </div>

                        <!-- Contact Content -->
                        <div id="content-contact" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üë§ First Name</label>
                                        <input type="text" id="contact-firstname" placeholder="John" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üë§ Last Name</label>
                                        <input type="text" id="contact-lastname" placeholder="Doe" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìû Phone Number</label>
                                    <input type="tel" id="contact-phone" placeholder="+1234567890" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìß Email Address</label>
                                    <input type="email" id="contact-email" placeholder="john@example.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üè¢ Organization</label>
                                    <input type="text" id="contact-organization" placeholder="Company Name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üåê Website</label>
                                    <input type="url" id="contact-website" placeholder="https://example.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                                </div>
                                <button id="generate-contact-qr" class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold hover:bg-orange-700 transition-colors">
                                    <i class="fas fa-address-card mr-2"></i>Generate Contact QR Code
                                </button>
                            </div>
                        </div>

                        <!-- Email Content -->
                        <div id="content-email" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìß To Email</label>
                                    <input type="email" id="email-to" placeholder="recipient@example.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìã Subject</label>
                                    <input type="text" id="email-subject" placeholder="Email Subject" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üí¨ Message Body</label>
                                    <textarea id="email-body" placeholder="Email message content..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" rows="4"></textarea>
                                </div>
                                <button id="generate-email-qr" class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                    <i class="fas fa-envelope mr-2"></i>Generate Email QR Code
                                </button>
                            </div>
                        </div>

                        <!-- Location Content -->
                        <div id="content-location" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üåç Latitude</label>
                                        <input type="number" step="any" id="location-latitude" placeholder="40.7128" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üåç Longitude</label>
                                        <input type="number" step="any" id="location-longitude" placeholder="-74.0060" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                                    </div>
                                </div>
                                
                                <!-- Google Maps Integration -->
                                <div class="flex gap-2">
                                    <button id="use-my-location-btn" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i class="fas fa-location-arrow mr-2"></i>Use My Location
                                    </button>
                                    <button id="open-in-maps-btn" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                        <i class="fab fa-google mr-2"></i>Open in Maps
                                    </button>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìç Location Name (Optional)</label>
                                    <input type="text" id="location-name" placeholder="Central Park, New York" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                                </div>
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <p class="text-sm text-blue-700">üí° <strong>Google Maps Integration:</strong> Use "My Location" to auto-fill coordinates, or "Open in Maps" to verify location accuracy.</p>
                                </div>
                                <button id="generate-location-qr" class="w-full bg-teal-600 text-white py-3 rounded-lg font-semibold hover:bg-teal-700 transition-colors">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Generate Location QR Code
                                </button>
                            </div>
                        </div>

                        <!-- Calendar Content -->
                        <div id="content-calendar" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Event Title</label>
                                    <input type="text" id="calendar-title" placeholder="Business Meeting" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üóìÔ∏è Start Date & Time</label>
                                        <input type="datetime-local" id="calendar-start" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üóìÔ∏è End Date & Time</label>
                                        <input type="datetime-local" id="calendar-end" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìç Location</label>
                                    <input type="text" id="calendar-location" placeholder="Conference Room A" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìù Description</label>
                                    <textarea id="calendar-description" placeholder="Event description and agenda..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" rows="3"></textarea>
                                </div>
                                <button id="generate-calendar-qr" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                                    <i class="fas fa-calendar-alt mr-2"></i>Generate Calendar QR Code
                                </button>
                            </div>
                        </div>

                        <!-- SMS Content -->
                        <div id="content-sms" class="qr-content-type hidden">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üì± Phone Number</label>
                                    <input type="tel" id="sms-phone" placeholder="+1234567890" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üí¨ Message</label>
                                    <textarea id="sms-message" placeholder="Your message here..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" rows="4"></textarea>
                                </div>
                                <div class="bg-yellow-50 p-3 rounded-lg">
                                    <p class="text-sm text-yellow-700">‚ö†Ô∏è <strong>Note:</strong> Message length affects QR code complexity. Shorter messages scan better.</p>
                                </div>
                                <button id="generate-sms-qr" class="w-full bg-pink-600 text-white py-3 rounded-lg font-semibold hover:bg-pink-700 transition-colors">
                                    <i class="fas fa-sms mr-2"></i>Generate SMS QR Code
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Settings -->
                    <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">
                            <i class="fas fa-cog mr-3 text-purple-600"></i>Quick Settings
                        </h2>
                        
                        <div class="space-y-6">
                            <!-- QR Code Size -->
                            <div class="qr-input-group">
                                <label class="block text-sm font-medium text-gray-700 mb-2">QR Code Size</label>
                                <select id="qr-size" class="w-full">
                                    <option value="200">Small (200x200px)</option>
                                    <option value="300" selected>Medium (300x300px)</option>
                                    <option value="400">Large (400x400px)</option>
                                    <option value="500">Extra Large (500x500px)</option>
                                </select>
                            </div>

                            <!-- QR Code Colors -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="qr-input-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Foreground</label>
                                    <input type="color" id="qr-color" value="#000000" class="w-full h-12 rounded-lg border-2">
                                </div>
                                <div class="qr-input-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Background</label>
                                    <input type="color" id="qr-bg-color" value="#ffffff" class="w-full h-12 rounded-lg border-2">
                                </div>
                            </div>

                            <!-- Privacy Settings -->
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Password Protection</span>
                                    <div id="password-toggle" class="qr-toggle-switch"></div>
                                </div>
                                <div id="password-input" class="hidden qr-input-group">
                                    <input type="password" id="file-password" placeholder="Enter password" class="w-full">
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Auto-expire in 7 days</span>
                                    <div id="expire-toggle" class="qr-toggle-switch active"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customize Tab -->
            <div id="content-customize" class="tab-content hidden">
                <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                        <i class="fas fa-palette mr-3 text-purple-600"></i>Customize Your QR Code
                    </h2>
                    
                    <!-- QR Code Type Selection -->
                    <div class="mb-8">
                        <div class="flex justify-center mb-6">
                            <div class="bg-gray-100 p-1 rounded-xl">
                                <button id="qr-type-file" class="qr-type-btn px-6 py-3 rounded-lg font-semibold active">
                                    <i class="fas fa-file mr-2"></i>File QR Code
                                </button>
                                <button id="qr-type-text" class="qr-type-btn px-6 py-3 rounded-lg font-semibold">
                                    <i class="fas fa-font mr-2"></i>Text QR Code
                                </button>
                            </div>
                        </div>
                        
                        <!-- Text QR Input -->
                        <div id="text-qr-section" class="hidden mb-6">
                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-keyboard mr-2 text-blue-600"></i>Enter Your Text
                                </h3>
                                <div class="space-y-4">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Text Content</label>
                                        <textarea id="qr-text-content" placeholder="Enter text, URL, or any content..." rows="4" class="w-full resize-none"></textarea>
                                        <div class="text-xs text-gray-500 mt-1">Max 2000 characters</div>
                                    </div>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                        <button class="text-preset" data-text="https://creativeaspirant.com">Website URL</button>
                                        <button class="text-preset" data-text="Contact: +1-234-567-8900">Phone Number</button>
                                        <button class="text-preset" data-text="mailto:info@creativeaspirant.com">Email Address</button>
                                        <button class="text-preset" data-text="WIFI:T:WPA;S:MyNetwork;P:MyPassword;;">WiFi Password</button>
                                    </div>
                                    <button id="generate-text-qr" class="bg-blue-600 text-white px-6 py-3 rounded-lg w-full hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-qrcode mr-2"></i>Generate Text QR Code
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8">
                        <!-- Customization Options -->
                        <div class="space-y-6">
                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-expand-arrows-alt mr-2 text-blue-600"></i>Size & Format
                                </h3>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Size</label>
                                        <select id="custom-qr-size" class="w-full">
                                            <option value="150">Tiny (150px)</option>
                                            <option value="200">Small (200px)</option>
                                            <option value="300" selected>Medium (300px)</option>
                                            <option value="400">Large (400px)</option>
                                            <option value="500">XL (500px)</option>
                                            <option value="800">XXL (800px)</option>
                                        </select>
                                    </div>
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Format</label>
                                        <select id="qr-format" class="w-full">
                                            <option value="png" selected>PNG</option>
                                            <option value="svg">SVG</option>
                                            <option value="pdf">PDF</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-palette mr-2 text-green-600"></i>Colors & Style
                                </h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <div class="text-center">
                                            <label class="block text-xs font-medium mb-2">Foreground</label>
                                            <input type="color" id="advanced-fg-color" value="#000000" class="w-full h-12 rounded-lg">
                                        </div>
                                        <div class="text-center">
                                            <label class="block text-xs font-medium mb-2">Background</label>
                                            <input type="color" id="advanced-bg-color" value="#ffffff" class="w-full h-12 rounded-lg">
                                        </div>
                                        <div class="text-center">
                                            <label class="block text-xs font-medium mb-2">Accent</label>
                                            <input type="color" id="accent-color" value="#6366f1" class="w-full h-12 rounded-lg">
                                        </div>
                                    </div>
                                    
                                    <div class="flex flex-wrap gap-2">
                                        <button class="color-preset bg-black text-white px-3 py-1 rounded text-xs" data-fg="#000000" data-bg="#ffffff">Classic</button>
                                        <button class="color-preset bg-blue-600 text-white px-3 py-1 rounded text-xs" data-fg="#1e40af" data-bg="#dbeafe">Blue</button>
                                        <button class="color-preset bg-green-600 text-white px-3 py-1 rounded text-xs" data-fg="#059669" data-bg="#d1fae5">Green</button>
                                        <button class="color-preset bg-purple-600 text-white px-3 py-1 rounded text-xs" data-fg="#7c3aed" data-bg="#ede9fe">Purple</button>
                                        <button class="color-preset bg-red-600 text-white px-3 py-1 rounded text-xs" data-fg="#dc2626" data-bg="#fee2e2">Red</button>
                                    </div>
                                </div>
                            </div>

                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-border-style mr-2 text-orange-600"></i>Advanced Options
                                </h3>
                                <div class="space-y-4">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Error Correction Level</label>
                                        <select id="error-correction" class="w-full">
                                            <option value="L">Low (7%)</option>
                                            <option value="M" selected>Medium (15%)</option>
                                            <option value="Q">Quartile (25%)</option>
                                            <option value="H">High (30%)</option>
                                        </select>
                                    </div>
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Border Size</label>
                                        <input type="range" id="border-size" min="0" max="10" value="2" class="w-full">
                                        <div class="text-xs text-gray-500 mt-1">Current: <span id="border-value">2</span> modules</div>
                                    </div>
                                </div>
                            </div>

                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-image mr-2 text-pink-600"></i>Logo & Branding
                                </h3>
                                <div class="space-y-4">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Logo Upload</label>
                                        <input type="file" id="logo-upload" accept="image/*" class="w-full">
                                        <div class="text-xs text-gray-500 mt-1">Recommended: Square image, max 100KB</div>
                                        <div id="logo-preview" class="hidden mt-3 p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <img id="logo-preview-img" src="" alt="Logo preview" class="w-12 h-12 object-cover rounded border">
                                                    <span id="logo-preview-name" class="ml-3 text-sm font-medium"></span>
                                                </div>
                                                <button id="remove-logo" class="text-red-600 hover:text-red-800 text-sm">
                                                    <i class="fas fa-trash mr-1"></i>Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Logo Size (%)</label>
                                        <input type="range" id="logo-size" min="10" max="30" value="20" class="w-full">
                                        <div class="text-xs text-gray-500 mt-1">Current: <span id="logo-size-value">20</span>%</div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium">Logo Background</span>
                                        <div id="logo-background-toggle" class="qr-toggle-switch active"></div>
                                    </div>
                                    <div class="mt-4">
                                        <button id="apply-logo-settings" class="bg-pink-600 text-white px-6 py-2 rounded-lg w-full hover:bg-pink-700 transition-colors">
                                            <i class="fas fa-magic mr-2"></i>Apply Logo to QR Code
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preview -->
                        <div class="text-center">
                            <div class="qr-feature-card p-8 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-6">
                                    <i class="fas fa-eye mr-2 text-indigo-600"></i>Live Preview
                                </h3>
                                <div id="qr-preview-container" class="bg-white p-6 rounded-xl border-2 border-gray-200 inline-block mb-6">
                                    <div class="w-64 h-64 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <p class="text-gray-500 text-center">Upload a file to see<br>QR code preview</p>
                                    </div>
                                </div>
                                <button id="apply-customization" class="qr-btn-secondary text-white px-6 py-3 rounded-xl font-semibold">
                                    <i class="fas fa-check mr-2"></i>Apply Changes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Privacy Tab -->
            <div id="content-privacy" class="tab-content hidden">
                <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                        <i class="fas fa-shield-alt mr-3 text-green-600"></i>Privacy & Security Options
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8">
                        <div class="space-y-6">
                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-lock mr-2 text-red-600"></i>Access Control
                                </h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium">Password Protection</span>
                                        <div id="privacy-password-toggle" class="qr-toggle-switch"></div>
                                    </div>
                                    <div id="privacy-password-input" class="hidden qr-input-group">
                                        <input type="password" id="privacy-password" placeholder="Enter secure password" class="w-full">
                                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters recommended</p>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium">Download Limit</span>
                                        <div id="download-limit-toggle" class="qr-toggle-switch"></div>
                                    </div>
                                    <div id="download-limit-input" class="hidden qr-input-group">
                                        <input type="number" id="max-downloads" min="1" max="1000" value="10" class="w-full">
                                        <p class="text-xs text-gray-500 mt-1">Maximum number of downloads allowed</p>
                                    </div>
                                </div>
                            </div>

                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-clock mr-2 text-yellow-600"></i>Expiration Settings
                                </h3>
                                <div class="space-y-4">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Auto-expire after</label>
                                        <select id="expiration-time" class="w-full">
                                            <option value="never">Never expire</option>
                                            <option value="1h">1 Hour</option>
                                            <option value="24h">24 Hours</option>
                                            <option value="7d" selected>7 Days</option>
                                            <option value="30d">30 Days</option>
                                            <option value="90d">90 Days</option>
                                        </select>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium">Email Notification</span>
                                        <div id="email-notify-toggle" class="qr-toggle-switch"></div>
                                    </div>
                                    <div id="email-notify-input" class="hidden qr-input-group">
                                        <input type="email" id="notification-email" placeholder="your@email.com" class="w-full">
                                        <p class="text-xs text-gray-500 mt-1">Get notified before file expires</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="qr-feature-card p-6 rounded-2xl">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-info-circle mr-2 text-blue-600"></i>Privacy Information
                            </h3>
                            <div class="space-y-4 text-sm">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-800 mb-2">üîí Data Security</h4>
                                    <p class="text-blue-700">All files are encrypted during transmission and stored securely on Cloudflare's global network.</p>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-800 mb-2">üåç Global CDN</h4>
                                    <p class="text-green-700">Files are distributed across multiple data centers for fast access worldwide.</p>
                                </div>
                                
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Public Access</h4>
                                    <p class="text-yellow-700">Without password protection, files are accessible to anyone with the link.</p>
                                </div>
                                
                                                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-purple-800 mb-2">üóëÔ∏è Auto Cleanup</h4>
                                <p class="text-purple-700">Files are automatically deleted based on your expiration settings.</p>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button id="apply-privacy-settings" class="qr-btn-primary text-white px-8 py-3 rounded-xl font-semibold">
                                <i class="fas fa-shield-alt mr-2"></i>Apply Privacy Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <!-- Share Tab -->
            <div id="content-share" class="tab-content hidden">
                <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                        <i class="fas fa-share-alt mr-3 text-blue-600"></i>Advanced Sharing Options
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8">
                        <div class="space-y-6">
                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-link mr-2 text-blue-600"></i>Share Links
                                </h3>
                                <div class="space-y-4">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Direct View Link</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="view-link" readonly class="flex-1 bg-gray-50">
                                            <button id="copy-view-link" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-2">Download Link</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="download-link" readonly class="flex-1 bg-gray-50">
                                            <button id="copy-download-link" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-envelope mr-2 text-green-600"></i>Email Sharing
                                </h3>
                                <div class="space-y-4">
                                    <div class="qr-input-group">
                                        <input type="email" id="recipient-email" placeholder="recipient@example.com" class="w-full">
                                    </div>
                                    <div class="qr-input-group">
                                        <textarea id="email-message" placeholder="Optional message..." rows="3" class="w-full resize-none"></textarea>
                                    </div>
                                                                    <button id="send-email" class="qr-btn-secondary text-white px-6 py-3 rounded-xl font-semibold w-full">
                                    <i class="fas fa-paper-plane mr-2"></i>Send Email
                                </button>
                                <div id="email-status" class="hidden mt-2 text-sm"></div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-share-alt mr-2 text-purple-600"></i>Social Media
                                </h3>
                                <div class="grid grid-cols-2 gap-3">
                                    <button id="share-twitter" class="bg-blue-400 text-white px-4 py-3 rounded-xl font-medium hover:bg-blue-500 transition-colors">
                                        <i class="fab fa-twitter mr-2"></i>Twitter
                                    </button>
                                    <button id="share-facebook" class="bg-blue-600 text-white px-4 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors">
                                        <i class="fab fa-facebook mr-2"></i>Facebook
                                    </button>
                                    <button id="share-linkedin" class="bg-blue-700 text-white px-4 py-3 rounded-xl font-medium hover:bg-blue-800 transition-colors">
                                        <i class="fab fa-linkedin mr-2"></i>LinkedIn
                                    </button>
                                    <button id="share-whatsapp" class="bg-green-500 text-white px-4 py-3 rounded-xl font-medium hover:bg-green-600 transition-colors">
                                        <i class="fab fa-whatsapp mr-2"></i>WhatsApp
                                    </button>
                                </div>
                            </div>

                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h3 class="text-lg font-semibold mb-4">
                                    <i class="fas fa-qrcode mr-2 text-indigo-600"></i>QR Code Download
                                </h3>
                                <div class="text-center space-y-4">
                                    <div id="share-qr-container" class="bg-white p-4 rounded-xl border-2 border-gray-200 inline-block">
                                        <div class="w-48 h-48 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <p class="text-gray-500 text-sm">QR Code will appear here</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 justify-center">
                                        <button id="download-qr-png" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800">
                                            <i class="fas fa-download mr-1"></i>PNG
                                        </button>
                                        <button id="download-qr-svg" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800">
                                            <i class="fas fa-download mr-1"></i>SVG
                                        </button>
                                        <button id="download-qr-pdf" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800">
                                            <i class="fas fa-download mr-1"></i>PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Analytics Tab -->
            <div id="content-analytics" class="tab-content hidden">
                <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800">
                            <i class="fas fa-chart-bar mr-3 text-indigo-600"></i>Analytics Dashboard
                        </h2>
                        <div class="flex gap-2">
                            <button id="refresh-analytics" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                            <button id="export-analytics" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Key Metrics -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8">
                        <div class="qr-feature-card p-6 rounded-2xl text-center hover:shadow-lg transition-shadow">
                            <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-qrcode text-blue-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold text-blue-600 mb-1" id="total-scans">0</div>
                            <div class="text-gray-600 text-sm">Total Scans</div>
                            <div class="text-xs text-green-600 mt-1" id="scans-change">+0%</div>
                        </div>
                        <div class="qr-feature-card p-6 rounded-2xl text-center hover:shadow-lg transition-shadow">
                            <div class="bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-download text-green-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold text-green-600 mb-1" id="total-downloads">0</div>
                            <div class="text-gray-600 text-sm">Downloads</div>
                            <div class="text-xs text-green-600 mt-1" id="downloads-change">+0%</div>
                        </div>
                        <div class="qr-feature-card p-6 rounded-2xl text-center hover:shadow-lg transition-shadow">
                            <div class="bg-purple-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-users text-purple-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold text-purple-600 mb-1" id="unique-visitors">0</div>
                            <div class="text-gray-600 text-sm">Unique Visitors</div>
                            <div class="text-xs text-green-600 mt-1" id="visitors-change">+0%</div>
                        </div>
                        <div class="qr-feature-card p-6 rounded-2xl text-center hover:shadow-lg transition-shadow">
                            <div class="bg-orange-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-clock text-orange-600 text-xl"></i>
                            </div>
                            <div class="text-3xl font-bold text-orange-600 mb-1" id="avg-time">0s</div>
                            <div class="text-gray-600 text-sm">Avg. View Time</div>
                            <div class="text-xs text-green-600 mt-1" id="time-change">+0%</div>
                        </div>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="grid lg:grid-cols-2 gap-8 mb-8">
                        <div class="qr-feature-card p-6 rounded-2xl">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">
                                    <i class="fas fa-chart-line mr-2 text-blue-600"></i>Usage Trends
                                </h3>
                                <select id="trend-period" class="text-sm border rounded px-2 py-1">
                                    <option value="7d">Last 7 days</option>
                                    <option value="30d" selected>Last 30 days</option>
                                    <option value="90d">Last 90 days</option>
                                </select>
                            </div>
                            <div id="usage-chart" class="h-64 bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fas fa-chart-line text-4xl text-blue-300 mb-2"></i>
                                    <p class="text-gray-500">Interactive chart will load here</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="qr-feature-card p-6 rounded-2xl">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-globe mr-2 text-green-600"></i>Geographic Distribution
                            </h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <span class="text-2xl mr-3">üá∫üá∏</span>
                                        <div>
                                            <div class="font-medium">United States</div>
                                            <div class="text-xs text-gray-500">North America</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-blue-600">45%</div>
                                        <div class="w-16 h-2 bg-gray-200 rounded-full mt-1">
                                            <div class="w-12 h-2 bg-blue-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <span class="text-2xl mr-3">üáÆüá≥</span>
                                        <div>
                                            <div class="font-medium">India</div>
                                            <div class="text-xs text-gray-500">Asia</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-green-600">30%</div>
                                        <div class="w-16 h-2 bg-gray-200 rounded-full mt-1">
                                            <div class="w-10 h-2 bg-green-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <span class="text-2xl mr-3">üá¨üáß</span>
                                        <div>
                                            <div class="font-medium">United Kingdom</div>
                                            <div class="text-xs text-gray-500">Europe</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-purple-600">15%</div>
                                        <div class="w-16 h-2 bg-gray-200 rounded-full mt-1">
                                            <div class="w-6 h-2 bg-purple-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <span class="text-2xl mr-3">üåç</span>
                                        <div>
                                            <div class="font-medium">Others</div>
                                            <div class="text-xs text-gray-500">Worldwide</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-orange-600">10%</div>
                                        <div class="w-16 h-2 bg-gray-200 rounded-full mt-1">
                                            <div class="w-4 h-2 bg-orange-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detailed Analytics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-8">
                        <div class="qr-feature-card p-6 rounded-2xl">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-mobile-alt mr-2 text-purple-600"></i>Device Types
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm flex items-center">
                                        <i class="fas fa-mobile-alt mr-2 text-purple-500"></i>Mobile
                                    </span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                                            <div class="w-12 h-2 bg-purple-500 rounded-full"></div>
                                        </div>
                                        <span class="text-xs font-medium">65%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm flex items-center">
                                        <i class="fas fa-desktop mr-2 text-blue-500"></i>Desktop
                                    </span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                                            <div class="w-8 h-2 bg-blue-500 rounded-full"></div>
                                        </div>
                                        <span class="text-xs font-medium">25%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm flex items-center">
                                        <i class="fas fa-tablet-alt mr-2 text-green-500"></i>Tablet
                                    </span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                                            <div class="w-4 h-2 bg-green-500 rounded-full"></div>
                                        </div>
                                        <span class="text-xs font-medium">10%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="qr-feature-card p-6 rounded-2xl">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-file-alt mr-2 text-orange-600"></i>File Types
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm flex items-center">
                                        <span class="mr-2">üìÑ</span>PDF
                                    </span>
                                    <span class="text-xs font-medium bg-orange-100 text-orange-800 px-2 py-1 rounded">40%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm flex items-center">
                                        <span class="mr-2">üñºÔ∏è</span>Images
                                    </span>
                                    <span class="text-xs font-medium bg-blue-100 text-blue-800 px-2 py-1 rounded">35%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm flex items-center">
                                        <span class="mr-2">üìù</span>Documents
                                    </span>
                                    <span class="text-xs font-medium bg-green-100 text-green-800 px-2 py-1 rounded">25%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="qr-feature-card p-6 rounded-2xl">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-clock mr-2 text-indigo-600"></i>Peak Hours
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">9:00 - 12:00</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                                            <div class="w-14 h-2 bg-indigo-500 rounded-full"></div>
                                        </div>
                                        <span class="text-xs font-medium">Peak</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">14:00 - 17:00</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                                            <div class="w-12 h-2 bg-indigo-400 rounded-full"></div>
                                        </div>
                                        <span class="text-xs font-medium">High</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">21:00 - 23:00</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                                            <div class="w-8 h-2 bg-indigo-300 rounded-full"></div>
                                        </div>
                                        <span class="text-xs font-medium">Medium</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="qr-results-section" class="hidden qr-fade-in">
                <div class="qr-glassmorphism rounded-2xl qr-card-shadow p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">üéâ QR Code Generated Successfully!</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8">
                        <!-- QR Code Section -->
                        <div class="text-center">
                            <h3 class="text-xl font-semibold text-gray-700 mb-6">üì± Your QR Code</h3>
                            <div id="qr-code-container" class="inline-block p-6 bg-white rounded-2xl border-2 border-gray-200 mb-6 qr-card-shadow"></div>
                            <p class="text-gray-600 mb-4">Scan with any QR code reader</p>
                            <div class="flex gap-3 justify-center">
                                <button id="qr-download-png-btn" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                                    <i class="fas fa-download mr-2"></i>PNG
                                </button>
                                <button id="qr-download-svg-btn" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                                    <i class="fas fa-download mr-2"></i>SVG
                                </button>
                            </div>
                        </div>
                        
                        <!-- Link Section (only for file uploads) -->
                        <div class="space-y-6" id="qr-links-section">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">üîó Shareable Links</h3>
                                <div class="space-y-3">
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-1">View Link</label>
                                        <div class="flex gap-2">
                                            <input id="qr-share-link" type="text" class="flex-1 bg-gray-50" readonly>
                                            <button id="qr-copy-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="qr-input-group">
                                        <label class="block text-sm font-medium mb-1">Download Link</label>
                                        <div class="flex gap-2">
                                            <input id="qr-download-share-link" type="text" class="flex-1 bg-gray-50" readonly>
                                            <button id="qr-copy-download-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- QR Data Section (for non-file QR codes) -->
                        <div class="space-y-6 hidden" id="qr-data-section">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">üìã QR Code Data</h3>
                                <div class="qr-input-group">
                                    <label class="block text-sm font-medium mb-1">Generated Data</label>
                                    <textarea id="qr-data-display" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm font-mono" rows="4" readonly></textarea>
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <button id="qr-copy-data-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i class="fas fa-copy mr-2"></i>Copy Data
                                    </button>
                                    <button id="qr-test-data-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
                                        <i class="fas fa-external-link-alt mr-2"></i>Test QR Code
                                    </button>
                                </div>
                            </div>
                            
                            <!-- File Info -->
                            <div class="qr-feature-card p-6 rounded-2xl">
                                <h4 class="font-semibold text-gray-700 mb-4">üìÑ File Information</h4>
                                <div id="qr-file-details" class="space-y-2 text-sm"></div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="flex gap-3">
                                <button id="qr-upload-another-btn" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all">
                                    <i class="fas fa-plus mr-2"></i>Upload Another
                                </button>
                                <button id="qr-share-social-btn" class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-700 hover:to-blue-700 transition-all">
                                    <i class="fas fa-share-alt mr-2"></i>Share Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toast Notifications -->
            <div id="qr-toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

            <!-- Ad placeholders removed for cleaner interface -->

            <!-- Footer with Creative Aspirant Link -->
            <div class="text-center mt-12 py-8 border-t border-gray-200">
                <p class="text-gray-600 mb-3 text-lg">Powered by</p>
                <a href="https://creativeaspirant.com/" target="_blank" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-bold text-xl transition-colors group">
                    <span class="mr-3 text-2xl group-hover:scale-110 transition-transform">üöÄ</span>
                    Creative Aspirant - Unlock Creativity & Productivity
                </a>
                <p class="text-gray-500 mt-3">Professional QR Code Generator with advanced features</p>
            </div>
        </div>
    </div>

    <script>
        // Enhanced QR Tool JavaScript with Advanced Features
        // ADSENSE PROTECTION LAYER 5: Isolated JavaScript Namespace
        (function() {
            'use strict';
            
            // Create isolated namespace to prevent AdSense conflicts
            const QR_NAMESPACE = window.QR_TOOL_ISOLATED = window.QR_TOOL_ISOLATED || {};
            
            // Configuration
            const WORKER_URL = 'https://qr-code-scanner.creativeaspirant101.workers.dev';
            const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB
            
            // AdSense Protection: Store original functions before they can be overridden
            QR_NAMESPACE.originalAlert = window.alert;
            QR_NAMESPACE.originalConsoleLog = console.log;
            QR_NAMESPACE.originalConsoleError = console.error;
            
            // State management
            let selectedFile = null;
            let selectedFiles = []; // For batch upload
            let currentQrCode = null;
            let currentUploadResult = null;
            let uploadedFiles = []; // Track all uploaded files
            let logoImage = null; // For logo embedding
            let qrSettings = {
                size: 300,
                fgColor: '#000000',
                bgColor: '#ffffff',
                errorCorrectionLevel: 'M',
                margin: 2,
                format: 'png',
                logoSize: 20,
                logoBackground: true
            };
            let privacySettings = {
                passwordProtected: false,
                password: '',
                downloadLimit: false,
                maxDownloads: 10,
                expirationTime: '7d',
                emailNotification: false,
                notificationEmail: ''
            };
            
            // DOM Elements - will be populated after DOM loads
            let elements = {};
            
            // QR Data Functions
            function copyQRData() {
                if (window.currentQRData) {
                    copyToClipboard(window.currentQRData, 'QR data copied to clipboard!');
                } else {
                    showToast('No QR data to copy', 'error');
                }
            }
            
            function testQRData() {
                if (!window.currentQRData || !window.currentQRType) {
                    showToast('No QR data to test', 'error');
                    return;
                }
                
                const qrType = window.currentQRType.toLowerCase();
                const qrData = window.currentQRData;
                
                try {
                    if (qrType === 'url') {
                        // Test URL
                        window.open(qrData, '_blank');
                    } else if (qrType === 'email') {
                        // Test email
                        window.location.href = qrData;
                    } else if (qrType === 'sms') {
                        // Test SMS
                        window.location.href = qrData;
                    } else if (qrType === 'location') {
                        // Test location
                        const coords = qrData.match(/geo:([0-9.-]+),([0-9.-]+)/);
                        if (coords) {
                            const mapsUrl = `https://www.google.com/maps?q=${coords[1]},${coords[2]}`;
                            window.open(mapsUrl, '_blank');
                        }
                    } else {
                        // For other types, copy to clipboard
                        copyToClipboard(qrData, `${window.currentQRType} data copied for testing!`);
                    }
                    showToast(`Testing ${window.currentQRType} QR code...`, 'success');
                } catch (error) {
                    showToast('Could not test QR code', 'error');
                }
            }

            // Setup download button event listeners
            function setupDownloadButtons() {
                console.log('Setting up download buttons...');
                
                // First set of download buttons (in share section)
                const downloadPngBtn = document.getElementById('download-qr-png');
                const downloadSvgBtn = document.getElementById('download-qr-svg');
                const downloadPdfBtn = document.getElementById('download-qr-pdf');
                
                // Second set of download buttons (in results section)
                const qrDownloadPngBtn = document.getElementById('qr-download-png-btn');
                const qrDownloadSvgBtn = document.getElementById('qr-download-svg-btn');
                
                if (downloadPngBtn) {
                    downloadPngBtn.addEventListener('click', () => downloadQRAsPNG('share'));
                    console.log('PNG download button (share) listener added');
                }
                if (downloadSvgBtn) {
                    downloadSvgBtn.addEventListener('click', () => downloadQRAsSVG('share'));
                    console.log('SVG download button (share) listener added');
                }
                if (downloadPdfBtn) {
                    downloadPdfBtn.addEventListener('click', () => downloadQRAsPDF('share'));
                    console.log('PDF download button (share) listener added');
                }
                if (qrDownloadPngBtn) {
                    qrDownloadPngBtn.addEventListener('click', () => downloadQRAsPNG('results'));
                    console.log('PNG download button (results) listener added');
                }
                if (qrDownloadSvgBtn) {
                    qrDownloadSvgBtn.addEventListener('click', () => downloadQRAsSVG('results'));
                    console.log('SVG download button (results) listener added');
                }
            }

            // Download QR code as PNG
            function downloadQRAsPNG(source = 'results') {
                console.log('Downloading QR as PNG from:', source);
                
                try {
                    let canvas;
                    
                    // Find the QR code canvas based on source
                    if (source === 'share') {
                        canvas = document.querySelector('#share-qr-container canvas');
                    } else {
                        canvas = document.querySelector('#qr-code-container canvas');
                    }
                    
                    if (!canvas) {
                        // Try to find any canvas with QR code
                        canvas = document.querySelector('canvas');
                    }
                    
                    if (!canvas) {
                        showToast('No QR code found to download', 'error');
                        return;
                    }
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.download = `qr-code-${Date.now()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    
                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showToast('QR code downloaded as PNG! üì•', 'success');
                    
                } catch (error) {
                    console.error('PNG download error:', error);
                    showToast('Failed to download PNG', 'error');
                }
            }

            // Download QR code as SVG
            function downloadQRAsSVG(source = 'results') {
                console.log('Downloading QR as SVG from:', source);
                
                try {
                    // Get the current QR data
                    let qrData = window.currentQRData || window.lastGeneratedQR || '';
                    
                    if (!qrData) {
                        showToast('No QR code data found to download', 'error');
                        return;
                    }
                    
                    // Generate SVG using QRCode library
                    if (typeof QRCode !== 'undefined' && QRCode.toString) {
                        QRCode.toString(qrData, {
                            type: 'svg',
                            width: 512,
                            margin: 2,
                            color: {
                                dark: '#000000',
                                light: '#FFFFFF'
                            }
                        }, function(error, svgString) {
                            if (error) {
                                console.error('SVG generation error:', error);
                                showToast('Failed to generate SVG', 'error');
                                return;
                            }
                            
                            // Create download link
                            const blob = new Blob([svgString], { type: 'image/svg+xml' });
                            const link = document.createElement('a');
                            link.download = `qr-code-${Date.now()}.svg`;
                            link.href = URL.createObjectURL(blob);
                            
                            // Trigger download
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Clean up
                            URL.revokeObjectURL(link.href);
                            
                            showToast('QR code downloaded as SVG! üì•', 'success');
                        });
                    } else {
                        showToast('SVG generation not available', 'error');
                    }
                    
                } catch (error) {
                    console.error('SVG download error:', error);
                    showToast('Failed to download SVG', 'error');
                }
            }

            // Download QR code as PDF
            function downloadQRAsPDF(source = 'results') {
                console.log('Downloading QR as PDF from:', source);
                
                try {
                    let canvas;
                    
                    // Find the QR code canvas based on source
                    if (source === 'share') {
                        canvas = document.querySelector('#share-qr-container canvas');
                    } else {
                        canvas = document.querySelector('#qr-code-container canvas');
                    }
                    
                    if (!canvas) {
                        // Try to find any canvas with QR code
                        canvas = document.querySelector('canvas');
                    }
                    
                    if (!canvas) {
                        showToast('No QR code found to download', 'error');
                        return;
                    }
                    
                    // Create a simple PDF using canvas data
                    const imgData = canvas.toDataURL('image/png');
                    
                    // Create a new window with PDF content
                    const pdfWindow = window.open('', '_blank');
                    pdfWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>QR Code PDF</title>
                            <style>
                                body { margin: 0; padding: 20px; text-align: center; font-family: Arial, sans-serif; }
                                .qr-container { margin: 20px auto; }
                                .qr-image { max-width: 400px; height: auto; border: 1px solid #ddd; }
                                .download-info { margin-top: 20px; color: #666; }
                                @media print { .download-info { display: none; } }
                            </style>
                        </head>
                        <body>
                            <div class="qr-container">
                                <h2>QR Code</h2>
                                <img src="${imgData}" alt="QR Code" class="qr-image">
                                <div class="download-info">
                                    <p>Generated by Creative Aspirant QR Generator</p>
                                    <p>Right-click and "Save as PDF" or use Ctrl+P to save as PDF</p>
                                </div>
                            </div>
                        </body>
                        </html>
                    `);
                    
                    // Focus the new window and trigger print dialog
                    pdfWindow.focus();
                    setTimeout(() => {
                        pdfWindow.print();
                    }, 500);
                    
                    showToast('QR code PDF opened! Use Ctrl+P to save üìÑ', 'success');
                    
                } catch (error) {
                    console.error('PDF download error:', error);
                    showToast('Failed to download PDF', 'error');
                }
            }

            // Initialize when DOM is ready
            document.addEventListener('DOMContentLoaded', function() {
            
            initializeApp();
            setupScrollAds();
            
            // Setup QR data button listeners
            document.getElementById('qr-copy-data-btn').addEventListener('click', copyQRData);
            document.getElementById('qr-test-data-btn').addEventListener('click', testQRData);
            
            // Setup download button listeners
            setupDownloadButtons();
        });
            
            // Also initialize when all scripts are loaded
            window.addEventListener('load', function() {
                console.log('Window loaded, checking QR libraries...');
                checkQRLibraries();
            });
            
            function checkQRLibraries() {
                console.log('QR Library Check:', {
                    QRCode: typeof QRCode !== 'undefined',
                    QRCode_toCanvas: typeof QRCode !== 'undefined' && typeof QRCode.toCanvas === 'function',
                    QRCode_toDataURL: typeof QRCode !== 'undefined' && typeof QRCode.toDataURL === 'function'
                });
                
                // Test QR generation with a simple example
                if (typeof QRCode !== 'undefined') {
                    console.log('QR Code library loaded successfully');
                } else {
                    console.warn('QR Code library not loaded, will use fallback methods');
                }
            }
            
            function initializeApp() {
                populateElements();
                setupEventListeners();
                updateUploadButton();
                initializeTabs();
                initializeToggles();
                initializeColorPresets();
                initializeQRTypeSelector();
            }
            
            function populateElements() {
                // AdSense Protection: Ensure we're only selecting elements within our isolated container
                const qrRoot = document.querySelector('.qr-app-isolation-layer');
                if (!qrRoot) {
                    console.error('QR Tool isolation container missing! AdSense may have interfered.');
                    return;
                }
                
                function safeGetElement(id) {
                    const element = qrRoot.querySelector('#' + id);
                    if (element) {
                        element.setAttribute('data-qr-protected', 'true');
                        element.setAttribute('data-adsense-ignore', 'true');
                    }
                    return element;
                }
                
                elements = {
                    // Upload elements
                    uploadSection: safeGetElement('content-upload'),
                    resultsSection: safeGetElement('qr-results-section'),
                    dropZone: safeGetElement('qr-drop-zone'),
                    fileInput: safeGetElement('qr-file-input'),
                    uploadBtn: safeGetElement('qr-upload-btn'),
                    uploadBtnText: safeGetElement('qr-upload-btn-text'),
                    uploadProgress: safeGetElement('qr-upload-progress'),
                    progressBar: safeGetElement('qr-progress-bar'),
                    progressText: safeGetElement('qr-progress-text'),
                    
                    // QR Code elements
                    qrCodeContainer: safeGetElement('qr-code-container'),
                    shareLink: safeGetElement('qr-share-link'),
                    downloadShareLink: safeGetElement('qr-download-share-link'),
                    copyBtn: safeGetElement('qr-copy-btn'),
                    copyDownloadBtn: safeGetElement('qr-copy-download-btn'),
                    fileDetails: safeGetElement('qr-file-details'),
                    uploadAnotherBtn: safeGetElement('qr-upload-another-btn'),
                    shareSocialBtn: safeGetElement('qr-share-social-btn'),
                    toastContainer: document.getElementById('qr-toast-container'),
                    
                    // Settings elements
                    qrSize: document.getElementById('qr-size'),
                    qrColor: document.getElementById('qr-color'),
                    qrBgColor: document.getElementById('qr-bg-color'),
                    
                    // Tab elements
                    tabs: {
                        upload: document.getElementById('tab-upload'),
                        customize: document.getElementById('tab-customize'),
                        privacy: document.getElementById('tab-privacy'),
                        share: document.getElementById('tab-share'),
                        analytics: document.getElementById('tab-analytics')
                    },
                    
                    tabContents: {
                        upload: document.getElementById('content-upload'),
                        customize: document.getElementById('content-customize'),
                        privacy: document.getElementById('content-privacy'),
                        share: document.getElementById('content-share'),
                        analytics: document.getElementById('content-analytics')
                    }
                };
            }
            
            // Utility Functions
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            function getSimpleFileType(contentType, filename) {
                const ext = filename.toLowerCase().split('.').pop();
                
                // Map complex MIME types to simple names
                const typeMap = {
                    'application/pdf': 'PDF Document',
                    'application/msword': 'Word Document',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Word Document',
                    'application/vnd.ms-excel': 'Excel Spreadsheet',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'Excel Spreadsheet',
                    'application/vnd.ms-powerpoint': 'PowerPoint Presentation',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PowerPoint Presentation',
                    'text/plain': 'Text File',
                    'image/jpeg': 'JPEG Image',
                    'image/png': 'PNG Image',
                    'image/gif': 'GIF Image',
                    'application/zip': 'ZIP Archive'
                };
                
                // First try exact MIME type match
                if (typeMap[contentType]) {
                    return typeMap[contentType];
                }
                
                // Then try by extension
                const extMap = {
                    'pdf': 'PDF Document', 'doc': 'Word Document', 'docx': 'Word Document',
                    'xls': 'Excel Spreadsheet', 'xlsx': 'Excel Spreadsheet',
                    'ppt': 'PowerPoint Presentation', 'pptx': 'PowerPoint Presentation',
                    'txt': 'Text File', 'jpg': 'JPEG Image', 'jpeg': 'JPEG Image',
                    'png': 'PNG Image', 'gif': 'GIF Image', 'zip': 'ZIP Archive'
                };
                
                return extMap[ext] || (ext ? `${ext.toUpperCase()} File` : 'Unknown File');
            }
            
            function getFileIcon(fileName) {
                const ext = fileName.toLowerCase().split('.').pop();
                const icons = {
                    pdf: 'üìÑ', doc: 'üìù', docx: 'üìù', xls: 'üìä', xlsx: 'üìä',
                    ppt: 'üìà', pptx: 'üìà', jpg: 'üñºÔ∏è', jpeg: 'üñºÔ∏è', png: 'üñºÔ∏è',
                    gif: 'üñºÔ∏è', svg: 'üñºÔ∏è', txt: 'üìã', zip: 'üóúÔ∏è', rar: 'üóúÔ∏è'
                };
                return icons[ext] || 'üìÅ';
            }
            
            function showToast(message, type = 'success') {
                // AdSense Protection: Check if container exists and is ours
                if (!elements.toastContainer || !document.querySelector('.qr-app-isolation-layer').contains(elements.toastContainer)) {
                    console.warn('Toast container missing or compromised by external scripts');
                    return;
                }
                
                const toast = document.createElement('div');
                toast.className = `qr-${type}-toast text-white px-6 py-4 rounded-xl shadow-2xl qr-fade-in flex items-center`;
                toast.setAttribute('data-qr-element', 'toast');
                toast.setAttribute('data-adsense-ignore', 'true');
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} mr-3"></i>
                    ${message}
                `;
                
                elements.toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }, 4000);
            }
            
            // Tab Management
            function initializeTabs() {
                Object.entries(elements.tabs).forEach(([key, tab]) => {
                    tab.addEventListener('click', () => switchTab(key));
                });
            }
            
            function switchTab(activeTab) {
                // Update tab buttons
                Object.entries(elements.tabs).forEach(([key, tab]) => {
                    if (key === activeTab) {
                        tab.className = tab.className.replace('qr-tab-inactive', 'qr-tab-active');
                    } else {
                        tab.className = tab.className.replace('qr-tab-active', 'qr-tab-inactive');
                    }
                });
                
                // Update tab contents
                Object.entries(elements.tabContents).forEach(([key, content]) => {
                    if (key === activeTab) {
                        content.classList.remove('hidden');
                        content.classList.add('qr-slide-up');
                    } else {
                        content.classList.add('hidden');
                        content.classList.remove('qr-slide-up');
                    }
                });
            }
            
            // Toggle switches
            function initializeToggles() {
                const toggles = document.querySelectorAll('.qr-toggle-switch');
                toggles.forEach(toggle => {
                    toggle.addEventListener('click', () => {
                        toggle.classList.toggle('active');
                        handleToggleChange(toggle);
                    });
                });
            }
            
            function handleToggleChange(toggle) {
                const toggleId = toggle.id;
                const isActive = toggle.classList.contains('active');
                
                // Handle specific toggle behaviors
                if (toggleId === 'password-toggle' || toggleId === 'privacy-password-toggle') {
                    const passwordInput = document.getElementById(toggleId.replace('toggle', 'input'));
                    if (passwordInput) {
                        passwordInput.style.display = isActive ? 'block' : 'none';
                    }
                }
                
                if (toggleId === 'download-limit-toggle') {
                    const limitInput = document.getElementById('download-limit-input');
                    if (limitInput) {
                        limitInput.style.display = isActive ? 'block' : 'none';
                    }
                }
                
                if (toggleId === 'email-notify-toggle') {
                    const emailInput = document.getElementById('email-notify-input');
                    if (emailInput) {
                        emailInput.style.display = isActive ? 'block' : 'none';
                    }
                }
            }
            
            // Color presets
            function initializeColorPresets() {
                const presets = document.querySelectorAll('.color-preset');
                presets.forEach(preset => {
                    preset.addEventListener('click', () => {
                        const fgColor = preset.dataset.fg;
                        const bgColor = preset.dataset.bg;
                        
                        document.getElementById('advanced-fg-color').value = fgColor;
                        document.getElementById('advanced-bg-color').value = bgColor;
                        
                        qrSettings.fgColor = fgColor;
                        qrSettings.bgColor = bgColor;
                        
                        if (currentUploadResult) {
                            updateQRPreview();
                        }
                    });
                });
            }
            
            // File validation
            function validateFile(file) {
                if (file.size > MAX_FILE_SIZE) {
                    showToast(`File size must be less than ${formatFileSize(MAX_FILE_SIZE)}`, 'error');
                    return false;
                }
                
                const dangerousExts = ['exe', 'bat', 'cmd', 'scr', 'js', 'vbs', 'ps1'];
                const ext = file.name.toLowerCase().split('.').pop();
                if (dangerousExts.includes(ext)) {
                    showToast('This file type is not allowed for security reasons', 'error');
                    return false;
                }
                
                return true;
            }
            
            function updateUploadButton() {
                if (selectedFile) {
                    elements.uploadBtn.disabled = false;
                    elements.uploadBtnText.innerHTML = `<i class="fas fa-upload mr-2"></i>Upload ${selectedFile.name}`;
                } else {
                    elements.uploadBtn.disabled = true;
                    elements.uploadBtnText.innerHTML = '<i class="fas fa-file mr-2"></i>Select a file to upload';
                }
            }
            
            // Enhanced QR Code generation with multiple fallbacks
            function generateQRCode(text, container = elements.qrCodeContainer) {
                console.log('Generating QR code for:', text);
                console.log('QR Settings:', qrSettings);
                console.log('Available QR libraries:', {
                    QRCode: typeof QRCode !== 'undefined',
                    window_QRCode: typeof window.QRCode !== 'undefined',
                    qrcode: typeof qrcode !== 'undefined'
                });
                
                container.innerHTML = '';
                
                // Method 1: Try the main QRCode library
                if (typeof QRCode !== 'undefined' && QRCode.toCanvas) {
                    try {
                        const options = {
                            width: qrSettings.size,
                            height: qrSettings.size,
                            margin: qrSettings.margin,
                            color: {
                                dark: qrSettings.fgColor,
                                light: qrSettings.bgColor
                            },
                            errorCorrectionLevel: qrSettings.errorCorrectionLevel
                        };
                        
                        QRCode.toCanvas(text, options, (error, canvas) => {
                            if (error) {
                                console.error('QRCode.toCanvas error:', error);
                                tryFallbackQRGeneration(text, container);
                            } else {
                                canvas.className = 'rounded-lg shadow-lg';
                                container.appendChild(canvas);
                                currentQrCode = canvas;
                                
                                // Store QR data for downloads
                                window.currentQRData = text;
                                window.lastGeneratedQR = text;
                                
                                console.log('QR Code generated successfully with QRCode.toCanvas');
                            }
                        });
                        return;
                    } catch (error) {
                        console.error('QRCode.toCanvas exception:', error);
                    }
                }
                
                // Method 2: Try alternative QR generation
                tryFallbackQRGeneration(text, container);
            }
            
            function tryFallbackQRGeneration(text, container) {
                console.log('Trying fallback QR generation methods...');
                
                // Method 2A: Try QRCode.toDataURL
                if (typeof QRCode !== 'undefined' && QRCode.toDataURL) {
                    try {
                        const options = {
                            width: qrSettings.size,
                            height: qrSettings.size,
                            margin: qrSettings.margin,
                            color: {
                                dark: qrSettings.fgColor,
                                light: qrSettings.bgColor
                            },
                            errorCorrectionLevel: qrSettings.errorCorrectionLevel
                        };
                        
                        QRCode.toDataURL(text, options, (error, url) => {
                            if (error) {
                                console.error('QRCode.toDataURL error:', error);
                                tryManualQRGeneration(text, container);
                            } else {
                                const img = document.createElement('img');
                                img.src = url;
                                img.className = 'rounded-lg shadow-lg';
                                img.style.maxWidth = qrSettings.size + 'px';
                                img.style.maxHeight = qrSettings.size + 'px';
                                container.appendChild(img);
                                currentQrCode = img;
                                
                                // Store QR data for downloads
                                window.currentQRData = text;
                                window.lastGeneratedQR = text;
                                
                                console.log('QR Code generated successfully with QRCode.toDataURL');
                            }
                        });
                        return;
                    } catch (error) {
                        console.error('QRCode.toDataURL exception:', error);
                    }
                }
                
                // Method 2B: Try manual QR generation
                tryManualQRGeneration(text, container);
            }
            
            function tryManualQRGeneration(text, container) {
                console.log('Trying manual QR generation...');
                
                // Method 3: Create canvas manually and use API service as fallback
                try {
                    const canvas = document.createElement('canvas');
                    const size = qrSettings.size;
                    canvas.width = size;
                    canvas.height = size;
                    canvas.className = 'rounded-lg shadow-lg';
                    
                    const ctx = canvas.getContext('2d');
                    
                    // Use QR Server API as fallback
                    const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}&color=${qrSettings.fgColor.replace('#', '')}&bgcolor=${qrSettings.bgColor.replace('#', '')}&margin=10&ecc=${qrSettings.errorCorrectionLevel}`;
                    
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = function() {
                        ctx.drawImage(img, 0, 0, size, size);
                        container.appendChild(canvas);
                        currentQrCode = canvas;
                        
                        // Store QR data for downloads
                        window.currentQRData = text;
                        window.lastGeneratedQR = text;
                        
                        console.log('QR Code generated successfully with API fallback');
                    };
                    img.onerror = function() {
                        console.error('QR API fallback failed');
                        showQRError(container);
                    };
                    img.src = qrApiUrl;
                    
                } catch (error) {
                    console.error('Manual QR generation failed:', error);
                    showQRError(container);
                }
            }
            
            function showQRError(container) {
                container.innerHTML = `
                    <div class="w-64 h-64 bg-gradient-to-br from-red-50 to-red-100 border-2 border-red-200 rounded-lg flex flex-col items-center justify-center p-4">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-3"></i>
                        <p class="text-red-700 text-center font-medium mb-2">QR Generation Failed</p>
                        <p class="text-red-600 text-sm text-center mb-3">Libraries failed to load</p>
                        <button onclick="retryQRGeneration()" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                            Retry
                        </button>
                    </div>
                `;
            }
            
            // Global retry function
            window.retryQRGeneration = function() {
                if (currentUploadResult) {
                    const shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    generateQRCode(shareUrl);
                }
            };
            
            function updateQRPreview() {
                if (currentUploadResult) {
                    const shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    const previewContainer = document.getElementById('qr-preview-container').querySelector('div');
                    generateQRCode(shareUrl, previewContainer);
                }
            }
            
            // File upload
            async function uploadFile() {
                if (!selectedFile) return;
                
                elements.uploadBtn.disabled = true;
                elements.uploadProgress.classList.remove('hidden');
                elements.progressBar.style.width = '0%';
                elements.progressText.textContent = 'Preparing upload...';
                
                try {
                    const formData = new FormData();
                    formData.append('file', selectedFile);
                    
                    // Add privacy settings to upload
                    formData.append('privacySettings', JSON.stringify(privacySettings));
                    
                    const xhr = new XMLHttpRequest();
                    
                    xhr.upload.addEventListener('progress', (e) => {
                        if (e.lengthComputable) {
                            const percentComplete = (e.loaded / e.total) * 100;
                            elements.progressBar.style.width = percentComplete + '%';
                            elements.progressText.textContent = `Uploading... ${Math.round(percentComplete)}%`;
                        }
                    });
                    
                    xhr.addEventListener('load', () => {
                        if (xhr.status === 200) {
                            try {
                                const result = JSON.parse(xhr.responseText);
                                console.log('Upload result:', result);
                                elements.progressText.textContent = 'Upload complete!';
                                showToast('File uploaded successfully! üéâ');
                                showResults(result);
                            } catch (parseError) {
                                console.error('Failed to parse response:', xhr.responseText);
                                showToast('Upload completed but response format error', 'error');
                            }
                        } else {
                            throw new Error(`Upload failed: ${xhr.statusText} - ${xhr.responseText}`);
                        }
                    });
                    
                    xhr.addEventListener('error', () => {
                        throw new Error('Upload failed: Network error');
                    });
                    
                    xhr.open('POST', `${WORKER_URL}/upload`);
                    xhr.send(formData);
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    showToast('Upload failed. Please try again.', 'error');
                    elements.uploadBtn.disabled = false;
                    elements.uploadProgress.classList.add('hidden');
                }
            }
            
            function showResults(uploadResult) {
                currentUploadResult = uploadResult;
                
                const shareUrl = `${WORKER_URL}/view/${uploadResult.id}`;
                const downloadUrl = `${WORKER_URL}/download/${uploadResult.id}`;
                
                elements.shareLink.value = shareUrl;
                elements.downloadShareLink.value = downloadUrl;
                generateQRCode(shareUrl);
                
                // Show link section and hide data section for file uploads
                document.getElementById('qr-links-section').classList.remove('hidden');
                document.getElementById('qr-data-section').classList.add('hidden');
                
                // Update file details
                elements.fileDetails.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Name:</span>
                            <span class="font-medium text-right">${getFileIcon(uploadResult.filename)} ${uploadResult.filename}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Size:</span>
                            <span class="font-medium">${formatFileSize(uploadResult.size)}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Type:</span>
                            <span class="font-medium">${getSimpleFileType(uploadResult.contentType, uploadResult.filename)}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Uploaded:</span>
                            <span class="font-medium">${new Date().toLocaleDateString()}</span>
                        </div>
                        <div class="mt-4 p-3 bg-yellow-50 rounded-lg text-yellow-800 text-xs">
                            <i class="fas fa-info-circle mr-2"></i>
                            Files are publicly accessible via the generated link
                        </div>
                    </div>
                `;
                
                // Update share tab with links
                document.getElementById('view-link').value = shareUrl;
                document.getElementById('download-link').value = downloadUrl;
                
                // Update share QR code
                const shareQrContainer = document.getElementById('share-qr-container').querySelector('div');
                generateQRCode(shareUrl, shareQrContainer);
                
                elements.resultsSection.classList.remove('hidden');
                elements.resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            function resetUploadForm() {
                selectedFile = null;
                currentUploadResult = null;
                elements.fileInput.value = '';
                elements.uploadProgress.classList.add('hidden');
                elements.resultsSection.classList.add('hidden');
                updateUploadButton();
                switchTab('upload');
            }
            
            // QR Type Management Functions
            function initializeQRTypeSelector() {
                const typeCards = document.querySelectorAll('.qr-type-card');
                const contentHeader = {
                    icon: document.getElementById('qr-content-icon'),
                    title: document.getElementById('qr-content-title'),
                    subtitle: document.getElementById('qr-content-subtitle')
                };

                const typeConfig = {
                    file: {
                        icon: 'fas fa-file-upload',
                        color: 'text-blue-600',
                        title: 'Upload Your File',
                        subtitle: 'Upload files and generate QR codes for easy sharing'
                    },
                    url: {
                        icon: 'fas fa-link',
                        color: 'text-green-600',
                        title: 'URL / Website QR Code',
                        subtitle: 'Generate QR codes for single or multiple website links'
                    },
                    wifi: {
                        icon: 'fas fa-wifi',
                        color: 'text-purple-600',
                        title: 'Wi-Fi QR Code',
                        subtitle: 'Create auto-connect WiFi QR codes for easy sharing'
                    },
                    contact: {
                        icon: 'fas fa-address-card',
                        color: 'text-orange-600',
                        title: 'Contact vCard QR Code',
                        subtitle: 'Share contact information that saves directly to phones'
                    },
                    email: {
                        icon: 'fas fa-envelope',
                        color: 'text-red-600',
                        title: 'Email QR Code',
                        subtitle: 'Pre-fill email drafts with recipient, subject, and body'
                    },
                    location: {
                        icon: 'fas fa-map-marker-alt',
                        color: 'text-teal-600',
                        title: 'Location QR Code',
                        subtitle: 'Share GPS coordinates that open in maps'
                    },
                    calendar: {
                        icon: 'fas fa-calendar-alt',
                        color: 'text-indigo-600',
                        title: 'Calendar Event QR Code',
                        subtitle: 'Create events that add directly to calendars'
                    },
                    sms: {
                        icon: 'fas fa-sms',
                        color: 'text-pink-600',
                        title: 'SMS QR Code',
                        subtitle: 'Pre-fill text messages with phone number and content'
                    }
                };

                typeCards.forEach(card => {
                    card.addEventListener('click', () => {
                        // Remove active class from all cards
                        typeCards.forEach(c => c.classList.remove('active'));
                        // Add active class to clicked card
                        card.classList.add('active');
                        
                        const type = card.dataset.type;
                        const config = typeConfig[type];
                        
                        // Update header
                        contentHeader.icon.className = config.icon + ' text-4xl ' + config.color + ' mb-3';
                        contentHeader.title.textContent = config.title;
                        contentHeader.subtitle.textContent = config.subtitle;
                        
                        // Show/hide content sections
                        document.querySelectorAll('.qr-content-type').forEach(content => {
                            content.classList.add('hidden');
                        });
                        document.getElementById('content-' + type).classList.remove('hidden');
                        
                        // Auto-scroll to input section with smooth animation
                        setTimeout(() => {
                            const inputSection = document.getElementById('qr-content-header');
                            if (inputSection) {
                                inputSection.scrollIntoView({ 
                                    behavior: 'smooth', 
                                    block: 'start',
                                    inline: 'nearest'
                                });
                            }
                        }, 100);
                    });
                });

                // Initialize generate buttons
                document.getElementById('generate-url-qr').addEventListener('click', generateURLQR);
                document.getElementById('generate-wifi-qr').addEventListener('click', generateWiFiQR);
                document.getElementById('generate-contact-qr').addEventListener('click', generateContactQR);
                document.getElementById('generate-email-qr').addEventListener('click', generateEmailQR);
                document.getElementById('generate-location-qr').addEventListener('click', generateLocationQR);
                document.getElementById('generate-calendar-qr').addEventListener('click', generateCalendarQR);
                document.getElementById('generate-sms-qr').addEventListener('click', generateSMSQR);
                
                // Initialize location map buttons
                document.getElementById('use-my-location-btn').addEventListener('click', getCurrentLocation);
                document.getElementById('open-in-maps-btn').addEventListener('click', openInGoogleMaps);
            }

            // QR Results Display for Non-File QR Codes
            function showQRResults(qrData, qrType, details) {
                // Generate QR Code for main container
                generateQRCode(qrData);
                
                // Also generate QR Code for preview container (QR Code Download section)
                const previewContainer = document.getElementById('qr-preview-container');
                if (previewContainer) {
                    const previewDiv = previewContainer.querySelector('div') || previewContainer;
                    generateQRCode(qrData, previewDiv);
                }
                
                // Update file details section with QR type info
                elements.fileDetails.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">QR Type:</span>
                            <span class="font-medium text-right">${getQRTypeIcon(qrType)} ${qrType}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Data Length:</span>
                            <span class="font-medium text-right">${qrData.length} characters</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Generated:</span>
                            <span class="font-medium">${new Date().toLocaleDateString()}</span>
                        </div>
                        ${details ? `<div class="mt-4 p-3 bg-blue-50 rounded-lg text-blue-800 text-xs">
                            <i class="fas fa-info-circle mr-2"></i>
                            ${details}
                        </div>` : ''}
                    </div>
                `;
                
                // Hide link section and show data section for non-file QR codes
                document.getElementById('qr-links-section').classList.add('hidden');
                document.getElementById('qr-data-section').classList.remove('hidden');
                
                // Update QR data display
                document.getElementById('qr-data-display').value = qrData;
                
                // Clear file links
                elements.shareLink.value = '';
                elements.downloadShareLink.value = '';
                document.getElementById('view-link').value = '';
                document.getElementById('download-link').value = '';
                
                // Show results section
                elements.resultsSection.classList.remove('hidden');
                elements.resultsSection.scrollIntoView({ behavior: 'smooth' });
                
                currentUploadResult = null; // Clear file upload result
                
                // Store current QR data for copy/test functions
                window.currentQRData = qrData;
                window.currentQRType = qrType;
            }
            
            function getQRTypeIcon(qrType) {
                const icons = {
                    'URL': 'üîó',
                    'Wi-Fi': 'üì∂',
                    'Contact': 'üë§',
                    'Email': 'üìß',
                    'Location': 'üìç',
                    'Calendar': 'üìÖ',
                    'SMS': 'üì±'
                };
                return icons[qrType] || 'üìã';
            }

            // QR Generation Functions
            async function generateURLQR() {
                const urlInput = document.getElementById('url-input').value.trim();
                const shortenUrls = document.getElementById('shorten-urls').checked;
                
                if (!urlInput) {
                    showToast('Please enter at least one URL', 'error');
                    return;
                }
                
                const urls = urlInput.split('\n').filter(url => url.trim());
                let qrData;
                
                if (urls.length === 1) {
                    qrData = urls[0].trim();
                } else {
                    // For multiple URLs, create a simple list
                    qrData = urls.join('\n');
                }
                
                try {
                    const details = urls.length > 1 ? `Contains ${urls.length} URLs` : 'Single URL QR code';
                    showQRResults(qrData, 'URL', details);
                    showToast('URL QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }
            
            async function generateWiFiQR() {
                const ssid = document.getElementById('wifi-ssid').value.trim();
                const password = document.getElementById('wifi-password').value;
                const security = document.getElementById('wifi-security').value;
                const hidden = document.getElementById('wifi-hidden').checked;
                
                if (!ssid) {
                    showToast('Please enter WiFi network name (SSID)', 'error');
                    return;
                }
                
                let wifiString = `WIFI:T:${security};S:${ssid};P:${password};H:${hidden ? 'true' : 'false'};;`;
                
                try {
                    const details = `Network: ${ssid} | Security: ${security}${password ? ' (Password Protected)' : ''}`;
                    showQRResults(wifiString, 'Wi-Fi', details);
                    showToast('WiFi QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }
            
            async function generateContactQR() {
                const firstName = document.getElementById('contact-firstname').value.trim();
                const lastName = document.getElementById('contact-lastname').value.trim();
                const phone = document.getElementById('contact-phone').value.trim();
                const email = document.getElementById('contact-email').value.trim();
                const organization = document.getElementById('contact-organization').value.trim();
                const website = document.getElementById('contact-website').value.trim();
                
                if (!firstName && !lastName && !phone && !email) {
                    showToast('Please fill in at least name, phone, or email', 'error');
                    return;
                }
                
                const vCard = `BEGIN:VCARD
VERSION:3.0
FN:${firstName} ${lastName}
N:${lastName};${firstName};;;
${phone ? `TEL:${phone}` : ''}
${email ? `EMAIL:${email}` : ''}
${organization ? `ORG:${organization}` : ''}
${website ? `URL:${website}` : ''}
END:VCARD`;
                
                try {
                    const details = `Contact: ${firstName} ${lastName}${organization ? ` (${organization})` : ''}`;
                    showQRResults(vCard, 'Contact', details);
                    showToast('Contact QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }
            
            async function generateEmailQR() {
                const to = document.getElementById('email-to').value.trim();
                const subject = document.getElementById('email-subject').value.trim();
                const body = document.getElementById('email-body').value.trim();
                
                if (!to) {
                    showToast('Please enter recipient email address', 'error');
                    return;
                }
                
                let mailtoString = `mailto:${to}`;
                const params = [];
                if (subject) params.push(`subject=${encodeURIComponent(subject)}`);
                if (body) params.push(`body=${encodeURIComponent(body)}`);
                
                if (params.length > 0) {
                    mailtoString += '?' + params.join('&');
                }
                
                try {
                    const details = `To: ${to}${subject ? ` | Subject: ${subject}` : ''}`;
                    showQRResults(mailtoString, 'Email', details);
                    showToast('Email QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }
            
            async function generateLocationQR() {
                const latitude = document.getElementById('location-latitude').value.trim();
                const longitude = document.getElementById('location-longitude').value.trim();
                const locationName = document.getElementById('location-name').value.trim();
                
                if (!latitude || !longitude) {
                    showToast('Please enter both latitude and longitude', 'error');
                    return;
                }
                
                let geoString = `geo:${latitude},${longitude}`;
                if (locationName) {
                    geoString += `?q=${encodeURIComponent(locationName)}`;
                }
                
                try {
                    const details = `Coordinates: ${latitude}, ${longitude}${locationName ? ` | Name: ${locationName}` : ''}`;
                    showQRResults(geoString, 'Location', details);
                    showToast('Location QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }

            // Google Maps Integration for Location
            function getCurrentLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            document.getElementById('location-latitude').value = position.coords.latitude.toFixed(6);
                            document.getElementById('location-longitude').value = position.coords.longitude.toFixed(6);
                            showToast('Location detected successfully!', 'success');
                        },
                        (error) => {
                            showToast('Could not get your location. Please enter manually.', 'error');
                        }
                    );
                } else {
                    showToast('Geolocation is not supported by this browser.', 'error');
                }
            }

            function openInGoogleMaps() {
                const latitude = document.getElementById('location-latitude').value.trim();
                const longitude = document.getElementById('location-longitude').value.trim();
                
                if (!latitude || !longitude) {
                    showToast('Please enter coordinates first', 'error');
                    return;
                }
                
                const mapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                window.open(mapsUrl, '_blank');
            }
            
            async function generateCalendarQR() {
                const title = document.getElementById('calendar-title').value.trim();
                const startDate = document.getElementById('calendar-start').value;
                const endDate = document.getElementById('calendar-end').value;
                const location = document.getElementById('calendar-location').value.trim();
                const description = document.getElementById('calendar-description').value.trim();
                
                if (!title || !startDate) {
                    showToast('Please enter event title and start date', 'error');
                    return;
                }
                
                const start = new Date(startDate).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                const end = endDate ? new Date(endDate).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z' : '';
                
                const calendarString = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${title}
DTSTART:${start}
${end ? `DTEND:${end}` : ''}
${location ? `LOCATION:${location}` : ''}
${description ? `DESCRIPTION:${description}` : ''}
END:VEVENT
END:VCALENDAR`;
                
                try {
                    const eventDate = new Date(startDate).toLocaleDateString();
                    const details = `Event: ${title} | Date: ${eventDate}${location ? ` | Location: ${location}` : ''}`;
                    showQRResults(calendarString, 'Calendar', details);
                    showToast('Calendar QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }
            
            async function generateSMSQR() {
                const phone = document.getElementById('sms-phone').value.trim();
                const message = document.getElementById('sms-message').value.trim();
                
                if (!phone) {
                    showToast('Please enter phone number', 'error');
                    return;
                }
                
                let smsString = `sms:${phone}`;
                if (message) {
                    smsString += `?body=${encodeURIComponent(message)}`;
                }
                
                try {
                    const details = `To: ${phone}${message ? ` | Message: ${message.substring(0, 50)}${message.length > 50 ? '...' : ''}` : ''}`;
                    showQRResults(smsString, 'SMS', details);
                    showToast('SMS QR Code generated successfully!', 'success');
                } catch (error) {
                    showToast('Failed to generate QR code', 'error');
                }
            }

            // Event Listeners
            function setupEventListeners() {
                // File input
                elements.dropZone.addEventListener('click', () => elements.fileInput.click());
                elements.fileInput.addEventListener('change', handleFileSelect);
                
                // Drag and drop
                elements.dropZone.addEventListener('dragover', handleDragOver);
                elements.dropZone.addEventListener('dragleave', handleDragLeave);
                elements.dropZone.addEventListener('drop', handleFileDrop);
                
                // Upload
                elements.uploadBtn.addEventListener('click', uploadFile);
                
                // Copy buttons
                elements.copyBtn.addEventListener('click', () => copyToClipboard(elements.shareLink.value, 'View link copied!'));
                elements.copyDownloadBtn.addEventListener('click', () => copyToClipboard(elements.downloadShareLink.value, 'Download link copied!'));
                
                // Other buttons
                elements.uploadAnotherBtn.addEventListener('click', resetUploadForm);
                elements.shareSocialBtn.addEventListener('click', () => {
                    switchTab('share');
                    // Scroll to Advanced Sharing Options
                    setTimeout(() => {
                        const shareSection = document.getElementById('content-share');
                        if (shareSection) {
                            shareSection.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'start',
                                inline: 'nearest'
                            });
                        }
                    }, 100);
                });
                
                // Settings
                elements.qrSize.addEventListener('change', updateQRSettings);
                elements.qrColor.addEventListener('change', updateQRSettings);
                elements.qrBgColor.addEventListener('change', updateQRSettings);
                
                // Share tab buttons
                setupShareButtons();
                setupCustomizationControls();
                setupBatchUpload();
                setupCameraUpload();
                setupPrivacyControls();
                setupAnalytics();
            }
            
            function handleFileSelect(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    if (validateFile(file)) {
                        selectedFile = file;
                        updateUploadButton();
                    }
                }
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                elements.dropZone.classList.add('dragover');
            }
            
            function handleDragLeave() {
                elements.dropZone.classList.remove('dragover');
            }
            
            function handleFileDrop(e) {
                e.preventDefault();
                elements.dropZone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (validateFile(file)) {
                        selectedFile = file;
                        updateUploadButton();
                    }
                }
            }
            
            function updateQRSettings() {
                qrSettings.size = parseInt(elements.qrSize.value);
                qrSettings.fgColor = elements.qrColor.value;
                qrSettings.bgColor = elements.qrBgColor.value;
                
                if (currentUploadResult) {
                    const shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    generateQRCode(shareUrl);
                }
            }
            
            async function copyToClipboard(text, message = 'Copied to clipboard!') {
                try {
                    await navigator.clipboard.writeText(text);
                    showToast(message);
                } catch (error) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast(message);
                }
            }
            
            // Share functionality
            function setupShareButtons() {
                const shareButtons = {
                    'copy-view-link': () => copyToClipboard(document.getElementById('view-link').value, 'View link copied!'),
                    'copy-download-link': () => copyToClipboard(document.getElementById('download-link').value, 'Download link copied!'),
                    'share-twitter': () => shareOnSocial('twitter'),
                    'share-facebook': () => shareOnSocial('facebook'),
                    'share-linkedin': () => shareOnSocial('linkedin'),
                    'share-whatsapp': () => shareOnSocial('whatsapp'),
                    'send-email': () => sendEmailShare()
                };
                
                Object.entries(shareButtons).forEach(([id, handler]) => {
                    const button = document.getElementById(id);
                    if (button) {
                        button.addEventListener('click', handler);
                    }
                });
            }
            
            async function sendEmailShare() {
                const recipientEmail = document.getElementById('recipient-email')?.value;
                const message = document.getElementById('email-message')?.value;
                const statusDiv = document.getElementById('email-status');
                
                // Check if we have either file upload or QR code data
                if (!currentUploadResult && !window.currentQRData) {
                    showToast('Please generate a QR code first', 'error');
                    return;
                }
                
                if (!recipientEmail) {
                    showToast('Please enter recipient email', 'error');
                    return;
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(recipientEmail)) {
                    showToast('Please enter a valid email address', 'error');
                    return;
                }
                
                statusDiv.className = 'mt-2 text-sm text-blue-600';
                statusDiv.textContent = 'Sending email...';
                statusDiv.classList.remove('hidden');
                
                try {
                    let shareUrl, subject, defaultMessage;
                    
                    if (currentUploadResult) {
                        // File upload sharing
                        shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                        subject = `File shared: ${currentUploadResult.filename}`;
                        defaultMessage = `I've shared a file with you using Creative Aspirant QR Code Generator. Click the link below to access it.`;
                    } else if (window.currentQRData) {
                        // QR Code sharing
                        shareUrl = window.currentQRData;
                        subject = `${window.currentQRType} QR Code shared`;
                        defaultMessage = `I've created a ${window.currentQRType} QR Code for you using Creative Aspirant QR Code Generator. Details: ${window.currentQRData.substring(0, 100)}${window.currentQRData.length > 100 ? '...' : ''}`;
                    }
                    
                    const emailData = {
                        to: recipientEmail,
                        subject: subject,
                        message: message || defaultMessage,
                        fileUrl: shareUrl,
                        fileName: currentUploadResult?.filename || `${window.currentQRType} QR Code`
                    };
                    
                    const response = await fetch(`${WORKER_URL}/send-email`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(emailData)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok && result.success) {
                        statusDiv.className = 'mt-2 text-sm text-green-600';
                        statusDiv.textContent = '‚úÖ Email sent successfully!';
                        showToast('Email sent successfully!');
                        
                        // Clear form
                        document.getElementById('recipient-email').value = '';
                        document.getElementById('email-message').value = '';
                        
                        setTimeout(() => {
                            statusDiv.classList.add('hidden');
                        }, 5000);
                        
                    } else {
                        throw new Error(result.error || 'Email sending failed');
                    }
                    
                } catch (error) {
                    console.error('Email sending error:', error);
                    statusDiv.className = 'mt-2 text-sm text-red-600';
                    statusDiv.textContent = '‚ùå Failed to send email';
                    showToast('Failed to send email: ' + error.message, 'error');
                }
            }
            
            function shareOnSocial(platform) {
                // Check if we have either file upload or QR code data
                if (!currentUploadResult && !window.currentQRData) {
                    showToast('Please generate a QR code first', 'error');
                    return;
                }
                
                let shareUrl, text;
                
                if (currentUploadResult) {
                    // File upload sharing
                    shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    text = `Check out this file I shared: ${currentUploadResult.filename}`;
                } else if (window.currentQRData) {
                    // QR Code sharing - share the QR data directly or create a shareable message
                    if (window.currentQRType === 'URL') {
                        shareUrl = window.currentQRData;
                        text = `Check out this link I found!`;
                    } else {
                        shareUrl = window.currentQRData;
                        text = `I created a ${window.currentQRType} QR Code using Creative Aspirant QR Generator!`;
                    }
                }
                
                const urls = {
                    twitter: `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(shareUrl)}`,
                    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`,
                    linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`,
                    whatsapp: `https://wa.me/?text=${encodeURIComponent(text + ' ' + shareUrl)}`
                };
                
                if (urls[platform]) {
                    window.open(urls[platform], '_blank', 'width=600,height=400');
                    showToast(`Opening ${platform.charAt(0).toUpperCase() + platform.slice(1)}...`, 'success');
                }
            }
            
            // Customization controls
            function setupCustomizationControls() {
                // Advanced color controls
                const advancedFg = document.getElementById('advanced-fg-color');
                const advancedBg = document.getElementById('advanced-bg-color');
                const customSize = document.getElementById('custom-qr-size');
                const errorCorrection = document.getElementById('error-correction');
                const borderSize = document.getElementById('border-size');
                const borderValue = document.getElementById('border-value');
                const applyBtn = document.getElementById('apply-customization');
                
                if (advancedFg) advancedFg.addEventListener('change', updateAdvancedSettings);
                if (advancedBg) advancedBg.addEventListener('change', updateAdvancedSettings);
                if (customSize) customSize.addEventListener('change', updateAdvancedSettings);
                if (errorCorrection) errorCorrection.addEventListener('change', updateAdvancedSettings);
                if (borderSize) {
                    borderSize.addEventListener('input', () => {
                        borderValue.textContent = borderSize.value;
                        updateAdvancedSettings();
                    });
                }
                if (applyBtn) applyBtn.addEventListener('click', applyCustomization);
            }
            
            function updateAdvancedSettings() {
                const advancedFg = document.getElementById('advanced-fg-color');
                const advancedBg = document.getElementById('advanced-bg-color');
                const customSize = document.getElementById('custom-qr-size');
                const errorCorrection = document.getElementById('error-correction');
                const borderSize = document.getElementById('border-size');
                
                if (advancedFg) qrSettings.fgColor = advancedFg.value;
                if (advancedBg) qrSettings.bgColor = advancedBg.value;
                if (customSize) qrSettings.size = parseInt(customSize.value);
                if (errorCorrection) qrSettings.errorCorrectionLevel = errorCorrection.value;
                if (borderSize) qrSettings.margin = parseInt(borderSize.value);
                
                updateQRPreview();
            }
            
            function applyCustomization() {
                if (currentUploadResult) {
                    const shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    generateQRCode(shareUrl);
                    showToast('QR code updated with new settings!');
                } else {
                    showToast('Please upload a file first', 'error');
                }
            }
            
            // Batch Upload Functions
            function setupBatchUpload() {
                const batchBtn = document.getElementById('batch-upload-btn');
                const batchInput = document.getElementById('qr-batch-input');
                
                if (batchBtn) {
                    batchBtn.addEventListener('click', () => batchInput.click());
                }
                
                if (batchInput) {
                    batchInput.addEventListener('change', handleBatchFileSelect);
                }
            }
            
            function handleBatchFileSelect(e) {
                selectedFiles = Array.from(e.target.files).filter(validateFile);
                if (selectedFiles.length > 0) {
                    showBatchProgress();
                    uploadBatchFiles();
                }
            }
            
            function showBatchProgress() {
                const container = document.getElementById('batch-progress-container');
                const filesList = document.getElementById('batch-files-list');
                
                container.classList.remove('hidden');
                filesList.innerHTML = '';
                
                selectedFiles.forEach((file, index) => {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'flex justify-between items-center p-2 bg-white rounded border';
                    fileDiv.innerHTML = `
                        <span class="text-sm">${getFileIcon(file.name)} ${file.name}</span>
                        <div class="flex items-center gap-2">
                            <div class="w-20 h-1 bg-gray-200 rounded">
                                <div id="batch-progress-${index}" class="h-1 bg-blue-500 rounded" style="width: 0%"></div>
                            </div>
                            <span id="batch-status-${index}" class="text-xs text-gray-500">Waiting</span>
                        </div>
                    `;
                    filesList.appendChild(fileDiv);
                });
            }
            
            async function uploadBatchFiles() {
                const results = [];
                let completed = 0;
                
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const statusSpan = document.getElementById(`batch-status-${i}`);
                    const progressBar = document.getElementById(`batch-progress-${i}`);
                    
                    try {
                        statusSpan.textContent = 'Uploading...';
                        statusSpan.className = 'text-xs text-blue-600';
                        
                        const result = await uploadSingleFile(file, (progress) => {
                            progressBar.style.width = progress + '%';
                        });
                        
                        results.push(result);
                        statusSpan.textContent = '‚úì Done';
                        statusSpan.className = 'text-xs text-green-600';
                        progressBar.style.width = '100%';
                        
                    } catch (error) {
                        statusSpan.textContent = '‚úó Failed';
                        statusSpan.className = 'text-xs text-red-600';
                        console.error(`Upload failed for ${file.name}:`, error);
                    }
                    
                    completed++;
                    const overallProgress = (completed / selectedFiles.length) * 100;
                    document.getElementById('batch-overall-bar').style.width = overallProgress + '%';
                    document.getElementById('batch-overall-progress').textContent = Math.round(overallProgress) + '%';
                }
                
                uploadedFiles = [...uploadedFiles, ...results];
                showToast(`Batch upload completed! ${results.length} files uploaded.`);
                updateAnalytics();
            }
            
            function uploadSingleFile(file, progressCallback) {
                return new Promise((resolve, reject) => {
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const xhr = new XMLHttpRequest();
                    
                    xhr.upload.addEventListener('progress', (e) => {
                        if (e.lengthComputable) {
                            const percentage = (e.loaded / e.total) * 100;
                            progressCallback(percentage);
                        }
                    });
                    
                    xhr.addEventListener('load', () => {
                        if (xhr.status === 200) {
                            const result = JSON.parse(xhr.responseText);
                            resolve(result);
                        } else {
                            reject(new Error(`Upload failed: ${xhr.statusText}`));
                        }
                    });
                    
                    xhr.addEventListener('error', () => {
                        reject(new Error('Network error'));
                    });
                    
                    xhr.open('POST', `${WORKER_URL}/upload`);
                    xhr.send(formData);
                });
            }
            
            // Camera Upload Functions
            function setupCameraUpload() {
                const cameraBtn = document.getElementById('camera-upload-btn');
                const cameraInput = document.getElementById('qr-camera-input');
                
                if (cameraBtn) {
                    cameraBtn.addEventListener('click', () => {
                        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                            cameraInput.click();
                        } else {
                            showToast('Camera not supported on this device', 'error');
                        }
                    });
                }
                
                if (cameraInput) {
                    cameraInput.addEventListener('change', handleCameraCapture);
                }
            }
            
            function handleCameraCapture(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    if (validateFile(file)) {
                        selectedFile = file;
                        updateUploadButton();
                        showToast('Photo captured! Ready to upload.');
                    }
                }
            }
            
            // Privacy Controls
            function setupPrivacyControls() {
                const applyBtn = document.getElementById('apply-privacy-settings');
                if (applyBtn) {
                    applyBtn.addEventListener('click', applyPrivacySettings);
                }
            }
            
            function applyPrivacySettings() {
                // Collect all privacy settings
                const passwordToggle = document.getElementById('privacy-password-toggle');
                const downloadToggle = document.getElementById('download-limit-toggle');
                const emailToggle = document.getElementById('email-notify-toggle');
                
                privacySettings.passwordProtected = passwordToggle?.classList.contains('active') || false;
                privacySettings.downloadLimit = downloadToggle?.classList.contains('active') || false;
                privacySettings.emailNotification = emailToggle?.classList.contains('active') || false;
                
                if (privacySettings.passwordProtected) {
                    privacySettings.password = document.getElementById('privacy-password')?.value || '';
                }
                
                if (privacySettings.downloadLimit) {
                    privacySettings.maxDownloads = parseInt(document.getElementById('max-downloads')?.value || '10');
                }
                
                privacySettings.expirationTime = document.getElementById('expiration-time')?.value || '7d';
                
                if (privacySettings.emailNotification) {
                    privacySettings.notificationEmail = document.getElementById('notification-email')?.value || '';
                }
                
                showToast('Privacy settings applied successfully!');
                console.log('Privacy settings:', privacySettings);
            }
            
            // Analytics Functions
            function setupAnalytics() {
                const refreshBtn = document.getElementById('refresh-analytics');
                const exportBtn = document.getElementById('export-analytics');
                
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', updateAnalytics);
                }
                
                if (exportBtn) {
                    exportBtn.addEventListener('click', exportAnalytics);
                }
                
                // Initialize analytics
                updateAnalytics();
            }
            
            function updateAnalytics() {
                // Show "Coming Soon" for analytics (will be implemented when tool becomes popular)
                
                // Update main metrics
                document.getElementById('total-scans').textContent = 'Coming Soon';
                document.getElementById('total-downloads').textContent = 'Coming Soon';
                document.getElementById('unique-visitors').textContent = 'Coming Soon';
                document.getElementById('avg-time').textContent = 'Coming Soon';
                
                // Update change indicators
                document.getElementById('scans-change').textContent = 'Coming Soon';
                document.getElementById('downloads-change').textContent = 'Coming Soon';
                document.getElementById('visitors-change').textContent = 'Coming Soon';
                document.getElementById('time-change').textContent = 'Coming Soon';
            }
            
            function exportAnalytics() {
                // Check if analytics are available
                if (document.getElementById('total-scans').textContent === 'Coming Soon') {
                    showToast('Analytics not available yet. Coming soon when tool becomes popular!', 'info');
                    return;
                }
                
                const data = {
                    exportDate: new Date().toISOString(),
                    totalScans: document.getElementById('total-scans').textContent,
                    totalDownloads: document.getElementById('total-downloads').textContent,
                    uniqueVisitors: document.getElementById('unique-visitors').textContent,
                    avgTime: document.getElementById('avg-time').textContent,
                    uploadedFiles: uploadedFiles.length
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `qr-analytics-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showToast('Analytics exported successfully!');
            }
            
            // Logo upload handling
            function setupLogoUpload() {
                const logoUpload = document.getElementById('logo-upload');
                const logoSize = document.getElementById('logo-size');
                const logoSizeValue = document.getElementById('logo-size-value');
                const applyLogoBtn = document.getElementById('apply-logo-settings');
                const removeLogo = document.getElementById('remove-logo');
                
                if (logoUpload) {
                    logoUpload.addEventListener('change', handleLogoUpload);
                }
                
                if (logoSize) {
                    logoSize.addEventListener('input', () => {
                        qrSettings.logoSize = parseInt(logoSize.value);
                        logoSizeValue.textContent = logoSize.value;
                    });
                }
                
                if (applyLogoBtn) {
                    applyLogoBtn.addEventListener('click', applyLogoToQR);
                }
                
                if (removeLogo) {
                    removeLogo.addEventListener('click', removeLogoFromQR);
                }
            }
            
            function handleLogoUpload(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    if (file.size > 100 * 1024) { // 100KB limit
                        showToast('Logo file too large. Please choose a file under 100KB.', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        logoImage = event.target.result;
                        showLogoPreview(file.name, logoImage);
                        showToast('Logo uploaded successfully! Click "Apply Logo to QR Code" to update.');
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            function showLogoPreview(fileName, imageSrc) {
                const preview = document.getElementById('logo-preview');
                const previewImg = document.getElementById('logo-preview-img');
                const previewName = document.getElementById('logo-preview-name');
                
                previewImg.src = imageSrc;
                previewName.textContent = fileName;
                preview.classList.remove('hidden');
            }
            
            function applyLogoToQR() {
                if (!logoImage) {
                    showToast('Please upload a logo first', 'error');
                    return;
                }
                
                if (currentUploadResult) {
                    const shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    generateQRCodeWithLogo(shareUrl);
                } else if (document.getElementById('qr-text-content')?.value) {
                    const textContent = document.getElementById('qr-text-content').value;
                    generateQRCodeWithLogo(textContent);
                } else {
                    showToast('Please upload a file or enter text first', 'error');
                }
            }
            
            function removeLogoFromQR() {
                logoImage = null;
                document.getElementById('logo-preview').classList.add('hidden');
                document.getElementById('logo-upload').value = '';
                showToast('Logo removed');
                
                // Regenerate QR without logo
                if (currentUploadResult) {
                    const shareUrl = `${WORKER_URL}/view/${currentUploadResult.id}`;
                    generateQRCode(shareUrl);
                } else if (document.getElementById('qr-text-content')?.value) {
                    const textContent = document.getElementById('qr-text-content').value;
                    generateQRCode(textContent);
                }
            }
            
            function generateQRCodeWithLogo(text, targetContainer = null) {
                console.log('Generating QR code with logo for:', text);
                
                // Find the correct container
                const container = targetContainer || 
                                elements.qrCodeContainer || 
                                document.getElementById('qr-preview-container')?.querySelector('div') ||
                                document.querySelector('#qr-preview-container div') ||
                                document.querySelector('[id*="qr-result"]');
                
                if (!container) {
                    console.error('QR container not found');
                    showToast('QR display container not found', 'error');
                    return;
                }
                
                console.log('Using container:', container);
                container.innerHTML = '<div class="text-center p-4"><i class="fas fa-spinner fa-spin text-2xl text-blue-600 mb-2"></i><br>Generating QR with logo...</div>';
                
                // Create canvas for QR with logo
                const canvas = document.createElement('canvas');
                const size = qrSettings.size || 300;
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // Use fallback QR generation method
                const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}&color=${qrSettings.fgColor.replace('#', '')}&bgcolor=${qrSettings.bgColor.replace('#', '')}&margin=${qrSettings.margin}&ecc=${qrSettings.errorCorrectionLevel}`;
                
                const qrImg = new Image();
                qrImg.crossOrigin = 'anonymous';
                qrImg.onload = function() {
                    // Draw QR code on canvas
                    ctx.drawImage(qrImg, 0, 0, size, size);
                    
                    // Add logo if available
                    if (logoImage) {
                        const logoImg = new Image();
                        logoImg.onload = function() {
                            const logoSize = (size * (qrSettings.logoSize || 20)) / 100;
                            const logoX = (size - logoSize) / 2;
                            const logoY = (size - logoSize) / 2;
                            
                            // Add background if enabled
                            if (qrSettings.logoBackground) {
                                ctx.fillStyle = qrSettings.bgColor || '#ffffff';
                                ctx.fillRect(logoX - 5, logoY - 5, logoSize + 10, logoSize + 10);
                            }
                            
                            // Draw logo
                            ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
                            
                            // Add to container
                            canvas.className = 'rounded-lg shadow-lg mx-auto';
                            container.innerHTML = '';
                            container.appendChild(canvas);
                            currentQrCode = canvas;
                            showToast('QR code with logo generated successfully! ‚ú®');
                        };
                        logoImg.onerror = function() {
                            console.error('Logo image load failed');
                            // Still show QR without logo
                            canvas.className = 'rounded-lg shadow-lg mx-auto';
                            container.innerHTML = '';
                            container.appendChild(canvas);
                            currentQrCode = canvas;
                            showToast('QR code generated (logo failed to load)', 'warning');
                        };
                        logoImg.src = logoImage;
                    } else {
                        // No logo, just show QR
                        canvas.className = 'rounded-lg shadow-lg mx-auto';
                        container.innerHTML = '';
                        container.appendChild(canvas);
                        currentQrCode = canvas;
                        showToast('QR code generated successfully!');
                    }
                };
                qrImg.onerror = function() {
                    console.error('QR API generation failed');
                    container.innerHTML = '<div class="text-center p-4 text-red-600"><i class="fas fa-exclamation-triangle text-2xl mb-2"></i><br>QR generation failed</div>';
                    showToast('QR code generation failed', 'error');
                };
                qrImg.src = qrApiUrl;
            }
            
            // Text QR functionality
            function setupTextQR() {
                const qrTypeFile = document.getElementById('qr-type-file');
                const qrTypeText = document.getElementById('qr-type-text');
                const textQrSection = document.getElementById('text-qr-section');
                const generateTextQr = document.getElementById('generate-text-qr');
                const textPresets = document.querySelectorAll('.text-preset');
                const textContent = document.getElementById('qr-text-content');
                
                if (qrTypeFile) {
                    qrTypeFile.addEventListener('click', () => {
                        qrTypeFile.classList.add('active');
                        qrTypeText.classList.remove('active');
                        textQrSection.classList.add('hidden');
                    });
                }
                
                if (qrTypeText) {
                    qrTypeText.addEventListener('click', () => {
                        qrTypeText.classList.add('active');
                        qrTypeFile.classList.remove('active');
                        textQrSection.classList.remove('hidden');
                    });
                }
                
                if (generateTextQr) {
                    generateTextQr.addEventListener('click', generateTextQRCode);
                }
                
                textPresets.forEach(preset => {
                    preset.addEventListener('click', () => {
                        const text = preset.getAttribute('data-text');
                        if (textContent) {
                            textContent.value = text;
                        }
                    });
                });
            }
            
            function generateTextQRCode() {
                const textContent = document.getElementById('qr-text-content').value.trim();
                
                if (!textContent) {
                    showToast('Please enter some text content', 'error');
                    return;
                }
                
                if (textContent.length > 2000) {
                    showToast('Text too long. Maximum 2000 characters allowed.', 'error');
                    return;
                }
                
                // Find the QR preview container in the customize tab
                const container = document.getElementById('qr-preview-container')?.querySelector('div') ||
                                document.querySelector('#content-customize .qr-feature-card:last-child div:last-child');
                
                if (!container) {
                    showToast('QR preview container not found', 'error');
                    console.error('Could not find QR preview container');
                    return;
                }
                
                console.log('Generating text QR for:', textContent);
                console.log('Using container:', container);
                
                // Use logo if available, otherwise regular QR
                if (logoImage) {
                    generateQRCodeWithLogo(textContent, container);
                } else {
                    generateQRCode(textContent, container);
                    showToast('Text QR code generated successfully! üéâ');
                }
            }

            // Initialize all features
            document.addEventListener('DOMContentLoaded', function() {
                setupLogoUpload();
                setupTextQR();
            });
            
            // Setup scroll-triggered ads
            function setupScrollAds() {
                const scrollAds = document.querySelectorAll('.scroll-ad');
                
                const observerOptions = {
                    threshold: 0.3,
                    rootMargin: '0px 0px -50px 0px'
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, observerOptions);
                
                scrollAds.forEach(ad => {
                    observer.observe(ad);
                });
            }
            
        })();
    </script>
    
    </div> <!-- Close QR Tool Isolation Layer -->
    
    <!-- AdSense Safe Zone Cleanup -->
    <script>
        // ADSENSE PROTECTION LAYER 4: Final Cleanup & Safety
        (function() {
            'use strict';
            
            // Ensure our tool remains isolated
            function finalIsolationCheck() {
                const qrRoot = document.getElementById('qr-app-root');
                if (qrRoot) {
                    // Add additional protection attributes
                    qrRoot.setAttribute('data-adsense-protected', 'true');
                    qrRoot.setAttribute('data-no-auto-ads', 'true');
                    qrRoot.setAttribute('data-adblock-key', 'qr-tool-protected');
                    
                    // Add ARIA label for accessibility and protection
                    qrRoot.setAttribute('aria-label', 'QR Code Generator Tool - AdSense Protected');
                    qrRoot.setAttribute('role', 'application');
                    
                    console.log('‚úÖ QR Tool AdSense Protection: ACTIVE');
                }
            }
            
            // Run final check
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', finalIsolationCheck);
            } else {
                finalIsolationCheck();
            }
            
            // ADSENSE PROTECTION LAYER 6: Interference Detection & Recovery
            function detectAndRecoverFromInterference() {
                const qrRoot = document.getElementById('qr-app-root');
                if (!qrRoot) {
                    console.error('üö® Critical: QR Tool container missing! Possible AdSense interference detected.');
                    return false;
                }
                
                // Check for injected ad elements within our container
                const adElements = qrRoot.querySelectorAll('ins, .adsbygoogle, .google-auto-placed, [data-ad-slot]');
                if (adElements.length > 0) {
                    console.warn('üö® AdSense interference detected! Removing', adElements.length, 'ad elements from QR tool.');
                    adElements.forEach(el => {
                        el.remove();
                        console.log('Removed interfering ad element:', el);
                    });
                }
                
                // Check if our critical elements still exist
                const criticalElements = [
                    'qr-code-container',
                    'qr-upload-btn',
                    'qr-drop-zone'
                ];
                
                let missingElements = [];
                criticalElements.forEach(id => {
                    if (!qrRoot.querySelector('#' + id)) {
                        missingElements.push(id);
                    }
                });
                
                if (missingElements.length > 0) {
                    console.error('üö® Critical QR elements missing:', missingElements);
                    console.log('This may indicate AdSense interference. Consider refreshing the page.');
                    return false;
                }
                
                return true;
            }
            
            // Periodic protection check (runs every 5 seconds)
            setInterval(function() {
                // Run AdSense protection
                if (window.QR_TOOL_ISOLATED && window.QR_TOOL_ISOLATED.protectContainer) {
                    window.QR_TOOL_ISOLATED.protectContainer();
                }
                
                // Run interference detection
                detectAndRecoverFromInterference();
            }, 5000);
            
            // Emergency recovery function
            window.QR_TOOL_EMERGENCY_RECOVERY = function() {
                console.log('üîß Running QR Tool Emergency Recovery...');
                if (detectAndRecoverFromInterference()) {
                    console.log('‚úÖ QR Tool recovered successfully!');
                    location.reload(); // Last resort: reload the page
                } else {
                    console.log('‚ùå Recovery failed. Please refresh the page manually.');
                }
            };
            
        })();
    </script>
    
</body>
</html>
